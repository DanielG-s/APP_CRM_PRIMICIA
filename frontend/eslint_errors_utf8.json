[{"filePath":"C:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\campaigns\\page.tsx","messages":[{"ruleId":"react-hooks/purity","severity":2,"message":"Error: Cannot call impure function during render\n\n`Math.random` is an impure function. Calling an impure function can produce unstable results that update unpredictably when the component happens to re-render. (https://react.dev/reference/rules/components-and-hooks-must-be-pure#components-and-hooks-must-be-idempotent).\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\campaigns\\page.tsx:107:11\n  105 |     const newCampaign: Campaign = {\n  106 |       ...campaign,\n> 107 |       id: Math.random().toString(36).substr(2, 9).toUpperCase(),\n      |           ^^^^^^^^^^^^^ Cannot call impure function\n  108 |       name: `${campaign.name} (C├│pia)`,\n  109 |       status: 'RASCUNHO',\n  110 |       createdAt: new Date().toLocaleString('pt-BR'),","line":107,"column":11,"nodeType":null,"endLine":107,"endColumn":24}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport { \r\n  Search, Calendar, Filter, Plus, MoreHorizontal, \r\n  Mail, MessageSquare, Smartphone, Trash2, Copy, FileEdit,\r\n  ChevronDown\r\n} from 'lucide-react';\r\n\r\n// --- TIPOS DE DADOS ---\r\ninterface Campaign {\r\n  id: string;\r\n  name: string;\r\n  segment: string;\r\n  channel: 'EMAIL' | 'SMS' | 'WHATSAPP';\r\n  status: 'ENVIO REALIZADO' | 'AGENDADO' | 'RASCUNHO' | 'ERRO';\r\n  type: string;\r\n  createdAt: string;\r\n  startDate: string;\r\n  endDate: string;\r\n  lastEdit: string;\r\n  editedBy: string;\r\n}\r\n\r\n// --- DADOS MOCKADOS (Simulando o Banco de Dados) ---\r\nconst MOCK_DATA: Campaign[] = [\r\n  {\r\n    id: '01KEHE3YVFNRJRY4SAM083ZWF',\r\n    name: 'HOT SUMMER',\r\n    segment: 'TODOS USUARIOS SEM ERRO',\r\n    channel: 'EMAIL',\r\n    status: 'ENVIO REALIZADO',\r\n    type: 'Apenas uma vez',\r\n    createdAt: '09/01/2026 ÔÇó 10:11',\r\n    startDate: '10/01/2026 ÔÇó 00:00',\r\n    endDate: 'Indeterminado',\r\n    lastEdit: '09/01/2026 ÔÇó 10:11',\r\n    editedBy: 'ADMIN'\r\n  },\r\n  {\r\n    id: '01KED0YQTB4TE9MMZ9R1AQ8J6A',\r\n    name: 'Basicos-sem-costura',\r\n    segment: 'Comprou moda ├¡ntima h├í 6 meses',\r\n    channel: 'EMAIL',\r\n    status: 'ENVIO REALIZADO',\r\n    type: 'Apenas uma vez',\r\n    createdAt: '07/01/2026 ÔÇó 17:04',\r\n    startDate: '09/01/2026 ÔÇó 00:00',\r\n    endDate: 'Indeterminado',\r\n    lastEdit: '07/01/2026 ÔÇó 17:15',\r\n    editedBy: 'ADMIN'\r\n  },\r\n  {\r\n    id: '01KEABMEP4CVX9196F5AVEPG89',\r\n    name: 'Bolsa Gift',\r\n    segment: 'TODOS USUARIOS SEM ERRO',\r\n    channel: 'WHATSAPP',\r\n    status: 'AGENDADO',\r\n    type: 'Apenas uma vez',\r\n    createdAt: '06/01/2026 ÔÇó 16:13',\r\n    startDate: '07/01/2026 ÔÇó 00:00',\r\n    endDate: 'Indeterminado',\r\n    lastEdit: '06/01/2026 ÔÇó 16:13',\r\n    editedBy: 'ADMIN'\r\n  },\r\n  {\r\n    id: '01KCSK66WHXT6NHW60DHYP1RMB',\r\n    name: 'Lojas Outlet',\r\n    segment: 'TODOS USUARIOS SEM ERRO',\r\n    channel: 'SMS',\r\n    status: 'RASCUNHO',\r\n    type: 'Apenas uma vez',\r\n    createdAt: '18/12/2025 ÔÇó 17:42',\r\n    startDate: '05/01/2026 ÔÇó 00:00',\r\n    endDate: 'Indeterminado',\r\n    lastEdit: '18/12/2025 ÔÇó 17:42',\r\n    editedBy: 'ADMIN'\r\n  }\r\n];\r\n\r\nexport default function CampaignListPage() {\r\n  const router = useRouter();\r\n  const [campaigns, setCampaigns] = useState<Campaign[]>([]);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  // Simula busca no banco de dados ao carregar\r\n  useEffect(() => {\r\n    setTimeout(() => {\r\n      setCampaigns(MOCK_DATA);\r\n      setIsLoading(false);\r\n    }, 500);\r\n  }, []);\r\n\r\n  // --- A├ç├òES ---\r\n\r\n  const handleDelete = (id: string) => {\r\n    if (confirm('Tem certeza que deseja excluir esta campanha?')) {\r\n      setCampaigns(prev => prev.filter(c => c.id !== id));\r\n    }\r\n  };\r\n\r\n  const handleDuplicate = (campaign: Campaign) => {\r\n    const newCampaign: Campaign = {\r\n      ...campaign,\r\n      id: Math.random().toString(36).substr(2, 9).toUpperCase(),\r\n      name: `${campaign.name} (C├│pia)`,\r\n      status: 'RASCUNHO',\r\n      createdAt: new Date().toLocaleString('pt-BR'),\r\n      lastEdit: new Date().toLocaleString('pt-BR')\r\n    };\r\n    setCampaigns([newCampaign, ...campaigns]);\r\n    alert('Campanha duplicada com sucesso!');\r\n  };\r\n\r\n  const handleEdit = (id: string) => {\r\n    // Redireciona para a p├ígina de edi├º├úo (usando a mesma estrutura do /new mas passando ID)\r\n    // Voc├¬ precisar├í adaptar o page.tsx do /new para aceitar edi├º├úo ou criar uma rota [id]\r\n    router.push(`/campaigns/${id}`); \r\n  };\r\n\r\n  const handleCreateNew = () => {\r\n    router.push('/campaigns/new');\r\n  };\r\n\r\n  // --- FILTROS ---\r\n  const filteredCampaigns = campaigns.filter(c => \r\n    c.name.toLowerCase().includes(searchTerm.toLowerCase()) || \r\n    c.id.toLowerCase().includes(searchTerm.toLowerCase())\r\n  );\r\n\r\n  // --- HELPER VISUAL ---\r\n  const getChannelIcon = (channel: string) => {\r\n    switch(channel) {\r\n      case 'EMAIL': return <Mail size={18} className=\"text-gray-500\" />;\r\n      case 'WHATSAPP': return <Smartphone size={18} className=\"text-green-600\" />;\r\n      case 'SMS': return <MessageSquare size={18} className=\"text-blue-500\" />;\r\n      default: return <Mail size={18} />;\r\n    }\r\n  };\r\n\r\n  const getStatusBadge = (status: string) => {\r\n    const styles: any = {\r\n      'ENVIO REALIZADO': 'bg-gray-200 text-gray-600',\r\n      'AGENDADO': 'bg-blue-100 text-blue-700',\r\n      'RASCUNHO': 'bg-yellow-100 text-yellow-700',\r\n      'ERRO': 'bg-red-100 text-red-700'\r\n    };\r\n    return (\r\n      <span className={`px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wide ${styles[status] || 'bg-gray-100'}`}>\r\n        ÔÇó {status}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-[#F9FAFB] font-sans text-gray-800 p-6\">\r\n      \r\n      {/* HEADER E ABAS */}\r\n      <div className=\"mb-6\">\r\n        <div className=\"flex justify-between items-center mb-4\">\r\n          <h1 className=\"text-2xl font-bold text-slate-800\">Canais</h1>\r\n          <button \r\n            onClick={handleCreateNew}\r\n            className=\"bg-[#00C475] hover:bg-[#00a865] text-white px-4 py-2 rounded font-medium text-sm transition-colors flex items-center gap-2\"\r\n          >\r\n            <Plus size={18} /> Criar campanha\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"border-b border-gray-200\">\r\n          <nav className=\"flex gap-6\">\r\n            <button className=\"pb-3 border-b-2 border-[#00C475] text-[#00C475] font-medium text-sm\">Lista de campanhas</button>\r\n            <button className=\"pb-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm\">Resultados de Canais</button>\r\n            <button className=\"pb-3 border-b-2 border-transparent text-gray-500 hover:text-gray-700 font-medium text-sm\">Tempo real</button>\r\n          </nav>\r\n        </div>\r\n      </div>\r\n\r\n      {/* ├üREA DE FILTROS */}\r\n      <div className=\"bg-white p-4 rounded-lg shadow-sm border border-gray-100 mb-6 space-y-4\">\r\n        \r\n        {/* Filtros de Data e Bot├Áes */}\r\n        <div className=\"flex flex-wrap items-center justify-between gap-4\">\r\n          <div className=\"flex items-center gap-2 bg-white border border-gray-300 rounded px-3 py-2 text-sm text-gray-600 w-full md:w-auto\">\r\n            <Calendar size={16} className=\"text-gray-400\" />\r\n            <span className=\"text-gray-400\">In├¡cio</span>\r\n            <span className=\"mx-2 text-gray-300\">ÔåÆ</span>\r\n            <span className=\"text-gray-400\">Fim</span>\r\n            <ChevronDown size={14} className=\"ml-2 text-gray-400\" />\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-3\">\r\n            <span className=\"text-sm font-semibold text-slate-700 flex items-center gap-2\">\r\n              Filtros e visualiza├º├Áes\r\n            </span>\r\n            <div className=\"h-4 w-px bg-gray-300 mx-2\"></div>\r\n            <button className=\"px-4 py-2 bg-gray-100 text-gray-600 rounded text-sm font-medium hover:bg-gray-200\">Limpar filtros</button>\r\n            <button className=\"px-4 py-2 bg-gray-200 text-gray-400 rounded text-sm font-medium cursor-not-allowed\">Aplicar</button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Barra de Busca */}\r\n        <div className=\"relative\">\r\n          <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400\" size={20} />\r\n          <input \r\n            type=\"text\"\r\n            placeholder=\"Buscar por nome ou ID\"\r\n            value={searchTerm}\r\n            onChange={(e) => setSearchTerm(e.target.value)}\r\n            className=\"w-full border border-gray-200 rounded-md py-3 pl-12 pr-4 text-sm focus:outline-none focus:ring-2 focus:ring-[#00C475]/50 focus:border-[#00C475]\"\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* TABELA */}\r\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden\">\r\n        <div className=\"overflow-x-auto\">\r\n          <table className=\"w-full text-left border-collapse\">\r\n            <thead>\r\n              <tr className=\"border-b border-gray-100\">\r\n                <th className=\"p-4 w-12 text-center text-gray-400 font-medium\">#</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider\">Campanhas</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider\">Status</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider\">Tipo</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider\">Cria├º├úo</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider\">In├¡cio</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider\">Fim</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider\">Edi├º├úo</th>\r\n                <th className=\"p-4 text-xs font-bold text-gray-500 uppercase tracking-wider text-right\">A├º├Áes</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody className=\"divide-y divide-gray-50\">\r\n              {isLoading ? (\r\n                <tr>\r\n                  <td colSpan={9} className=\"p-8 text-center text-gray-500\">Carregando campanhas...</td>\r\n                </tr>\r\n              ) : filteredCampaigns.length === 0 ? (\r\n                <tr>\r\n                  <td colSpan={9} className=\"p-8 text-center text-gray-500\">Nenhuma campanha encontrada.</td>\r\n                </tr>\r\n              ) : (\r\n                filteredCampaigns.map((campaign) => (\r\n                  <tr key={campaign.id} className=\"hover:bg-gray-50 transition-colors group\">\r\n                    <td className=\"p-4 text-center\">\r\n                      <div className=\"flex justify-center\">{getChannelIcon(campaign.channel)}</div>\r\n                    </td>\r\n                    <td className=\"p-4\">\r\n                      <p className=\"font-bold text-slate-800 text-sm\">{campaign.name}</p>\r\n                      <p className=\"text-xs text-green-600 underline cursor-pointer hover:text-green-700 mt-0.5 mb-1 truncate max-w-[200px]\">\r\n                        Segmento: {campaign.segment}\r\n                      </p>\r\n                      <span className=\"inline-block bg-gray-100 text-gray-500 text-[10px] px-1.5 py-0.5 rounded font-mono border border-gray-200\">\r\n                        ID: {campaign.id}\r\n                      </span>\r\n                    </td>\r\n                    <td className=\"p-4\">{getStatusBadge(campaign.status)}</td>\r\n                    <td className=\"p-4 text-sm text-gray-600\">{campaign.type}</td>\r\n                    <td className=\"p-4 text-xs text-gray-500\">{campaign.createdAt}</td>\r\n                    <td className=\"p-4 text-xs text-gray-500\">{campaign.startDate}</td>\r\n                    <td className=\"p-4 text-xs text-gray-500\">{campaign.endDate}</td>\r\n                    <td className=\"p-4\">\r\n                      <p className=\"text-xs text-gray-500\">{campaign.lastEdit}</p>\r\n                      <p className=\"text-xs text-gray-400\">{campaign.editedBy}</p>\r\n                    </td>\r\n                    <td className=\"p-4 text-right\">\r\n                      {/* Bot├Áes de A├º├úo (Aparecem no Hover ou fixos) */}\r\n                      <div className=\"flex justify-end gap-2 opacity-100 md:opacity-0 md:group-hover:opacity-100 transition-opacity\">\r\n                        <button \r\n                          onClick={() => handleDuplicate(campaign)}\r\n                          title=\"Duplicar\"\r\n                          className=\"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded\"\r\n                        >\r\n                          <Copy size={16} />\r\n                        </button>\r\n                        <button \r\n                          onClick={() => handleEdit(campaign.id)}\r\n                          title=\"Editar\"\r\n                          className=\"p-1.5 text-gray-400 hover:text-green-600 hover:bg-green-50 rounded\"\r\n                        >\r\n                          <FileEdit size={16} />\r\n                        </button>\r\n                        <button \r\n                          onClick={() => handleDelete(campaign.id)}\r\n                          title=\"Excluir\"\r\n                          className=\"p-1.5 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded\"\r\n                        >\r\n                          <Trash2 size={16} />\r\n                        </button>\r\n                      </div>\r\n                    </td>\r\n                  </tr>\r\n                ))\r\n              )}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\components\\editor\\EmailEditor.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\components\\editor\\EmailEditor.tsx:96:7\n  94 |   useEffect(() => {\n  95 |     if (isOpen && initialData) {\n> 96 |       setData({\n     |       ^^^^^^^ Avoid calling setState() directly within an effect\n  97 |         url: initialData.href || '',\n  98 |         text: initialData.content || '',\n  99 |         title: initialData.title || '',","line":96,"column":7,"nodeType":null,"endLine":96,"endColumn":14},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\components\\editor\\EmailEditor.tsx:218:9\n  216 |     const attrs = selectedBlock.getAttributes();\n  217 |     if (attrs['padding-top'] || attrs['padding-bottom'] || attrs['padding-left'] || attrs['padding-right']) {\n> 218 |         setExpandPadding(true);\n      |         ^^^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  219 |     } else {\n  220 |         setExpandPadding(false);\n  221 |     }","line":218,"column":9,"nodeType":null,"endLine":218,"endColumn":25}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect, useRef, useState } from 'react';\r\nimport grapesjs from 'grapesjs';\r\nimport 'grapesjs/dist/css/grapes.min.css';\r\nimport grapesjsMjml from 'grapesjs-mjml';\r\nimport { \r\n  Type, MousePointerClick, Copy, Trash2, X, \r\n  ChevronsDown, AlignLeft, AlignCenter, AlignRight, \r\n  ArrowLeft\r\n} from 'lucide-react';\r\n\r\n// =============================================================================\r\n// 1. COMPONENTES DE UI (Visual Personalizado)\r\n// =============================================================================\r\n\r\nconst Label = ({ children }: { children: React.ReactNode }) => (\r\n  <label className=\"block text-[11px] text-gray-500 mb-1.5 font-bold uppercase tracking-wider\">\r\n    {children}\r\n  </label>\r\n);\r\n\r\n// Input Contador [- 14 +]\r\nconst CounterInput = ({ value, onChange, min = 0, max = 600 }: any) => {\r\n  const safeVal = parseInt(value) || 0;\r\n  \r\n  const handleDecrement = () => onChange(Math.max(min, safeVal - 1));\r\n  const handleIncrement = () => onChange(Math.min(max, safeVal + 1));\r\n  \r\n  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n    const val = e.target.value.replace(/[^0-9]/g, '');\r\n    onChange(val);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex items-center border border-gray-200 rounded bg-white h-9 w-full overflow-hidden hover:border-indigo-300 transition-colors group\">\r\n      <button onClick={handleDecrement} className=\"w-8 flex items-center justify-center text-gray-400 bg-gray-50 group-hover:bg-indigo-50 group-hover:text-indigo-600 border-r border-gray-100 h-full transition-colors active:bg-indigo-100\">-</button>\r\n      <input \r\n        type=\"text\" \r\n        value={value} \r\n        onChange={handleChange}\r\n        className=\"flex-1 w-full text-center text-sm text-gray-700 outline-none font-medium bg-transparent px-1\"\r\n      />\r\n      <button onClick={handleIncrement} className=\"w-8 flex items-center justify-center text-gray-400 bg-gray-50 group-hover:bg-indigo-50 group-hover:text-indigo-600 border-l border-gray-100 h-full transition-colors active:bg-indigo-100\">+</button>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Input de Cor [Quadrado + Hex]\r\nconst ColorInput = ({ value, onChange }: any) => (\r\n  <div className=\"flex items-center border border-gray-200 rounded bg-white h-9 px-2 relative w-full hover:border-indigo-300 transition-colors\">\r\n    <div className=\"w-5 h-5 border border-gray-200 shadow-sm mr-2 rounded-sm\" style={{ backgroundColor: value || 'transparent' }} />\r\n    <span className=\"text-gray-400 mr-1 text-xs select-none\">#</span>\r\n    <input \r\n      type=\"text\" value={(value || '').replace('#', '')} \r\n      onChange={(e) => onChange('#' + e.target.value)}\r\n      className=\"w-full text-sm text-gray-700 outline-none font-medium uppercase\" maxLength={6} placeholder=\"000000\"\r\n    />\r\n    <input type=\"color\" value={value || '#000000'} onChange={(e) => onChange(e.target.value)} className=\"absolute inset-0 opacity-0 cursor-pointer w-full h-full\" />\r\n  </div>\r\n);\r\n\r\n// Dropdown Customizado\r\nconst Select = ({ value, onChange, options }: any) => (\r\n  <div className=\"relative w-full\">\r\n    <select \r\n      value={value} onChange={(e) => onChange(e.target.value)}\r\n      className=\"w-full p-2 pr-8 text-sm border border-gray-200 rounded bg-white text-gray-700 font-medium outline-none appearance-none h-9 transition-shadow focus:border-indigo-500 hover:border-indigo-300\"\r\n    >\r\n      {options.map((opt: any) => <option key={opt.value} value={opt.value}>{opt.label}</option>)}\r\n    </select>\r\n    <div className=\"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500\"><ChevronsDown size={14} /></div>\r\n  </div>\r\n);\r\n\r\n// Toggle Switch\r\nconst Toggle = ({ checked, onChange }: any) => (\r\n  <button onClick={() => onChange(!checked)} className={`w-9 h-5 rounded-full p-0.5 transition-colors duration-200 ${checked ? 'bg-indigo-600' : 'bg-gray-300'}`}>\r\n    <div className={`bg-white w-4 h-4 rounded-full shadow-sm transform transition-transform duration-200 ${checked ? 'translate-x-4' : 'translate-x-0'}`} />\r\n  </button>\r\n);\r\n\r\n// =============================================================================\r\n// 2. MODAL DE LINK\r\n// =============================================================================\r\n\r\nconst LinkModal = ({ isOpen, onClose, onSave, initialData }: any) => {\r\n  const [data, setData] = useState({\r\n    url: '',\r\n    text: '',\r\n    title: '',\r\n    target: '_blank',\r\n    underline: true\r\n  });\r\n\r\n  useEffect(() => {\r\n    if (isOpen && initialData) {\r\n      setData({\r\n        url: initialData.href || '',\r\n        text: initialData.content || '',\r\n        title: initialData.title || '',\r\n        target: initialData.target || '_blank',\r\n        underline: initialData.style?.textDecoration !== 'none'\r\n      });\r\n    }\r\n  }, [isOpen, initialData]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm animate-in fade-in duration-200\">\r\n      <div className=\"bg-slate-800 text-white rounded-lg shadow-2xl w-[500px] overflow-hidden border border-slate-600\">\r\n        {/* Header */}\r\n        <div className=\"flex items-center justify-between px-4 py-3 border-b border-slate-700 bg-slate-900\">\r\n          <span className=\"font-bold text-sm\">Inserir link</span>\r\n          <button onClick={onClose} className=\"text-slate-400 hover:text-white\"><X size={16}/></button>\r\n        </div>\r\n        \r\n        {/* Body */}\r\n        <div className=\"p-6 space-y-4 text-sm\">\r\n          {/* URL */}\r\n          <div className=\"grid grid-cols-4 items-center gap-4\">\r\n            <label className=\"text-slate-400 text-right\">Url</label>\r\n            <div className=\"col-span-3\">\r\n               <input \r\n                 type=\"text\" \r\n                 className=\"w-full bg-slate-700 border border-slate-600 rounded p-2 text-white outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500\"\r\n                 value={data.url}\r\n                 onChange={e => setData({...data, url: e.target.value})}\r\n                 autoFocus\r\n                 placeholder=\"https://...\"\r\n               />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Checkbox */}\r\n          <div className=\"grid grid-cols-4 items-center gap-4\">\r\n             <div className=\"col-start-2 col-span-3 flex items-center gap-2\">\r\n                <input \r\n                  type=\"checkbox\" \r\n                  id=\"underline\"\r\n                  checked={data.underline}\r\n                  onChange={e => setData({...data, underline: e.target.checked})}\r\n                  className=\"rounded bg-slate-700 border-slate-600 text-indigo-500 focus:ring-offset-slate-800\"\r\n                />\r\n                <label htmlFor=\"underline\" className=\"text-slate-300 cursor-pointer select-none\">Sublinha este link</label>\r\n             </div>\r\n          </div>\r\n\r\n          {/* Texto */}\r\n          <div className=\"grid grid-cols-4 items-center gap-4\">\r\n            <label className=\"text-slate-400 text-right\">Texto</label>\r\n            <div className=\"col-span-3\">\r\n               <input \r\n                 type=\"text\" \r\n                 className=\"w-full bg-slate-700 border border-slate-600 rounded p-2 text-white outline-none focus:border-indigo-500\"\r\n                 value={data.text}\r\n                 onChange={e => setData({...data, text: e.target.value})}\r\n               />\r\n            </div>\r\n          </div>\r\n\r\n          {/* T├¡tulo */}\r\n          <div className=\"grid grid-cols-4 items-center gap-4\">\r\n            <label className=\"text-slate-400 text-right\">T├¡tulo</label>\r\n            <div className=\"col-span-3\">\r\n               <input \r\n                 type=\"text\" \r\n                 className=\"w-full bg-slate-700 border border-slate-600 rounded p-2 text-white outline-none focus:border-indigo-500\"\r\n                 value={data.title}\r\n                 onChange={e => setData({...data, title: e.target.value})}\r\n               />\r\n            </div>\r\n          </div>\r\n\r\n          {/* Alvo */}\r\n          <div className=\"grid grid-cols-4 items-center gap-4\">\r\n            <label className=\"text-slate-400 text-right\">Alvo</label>\r\n            <div className=\"col-span-3\">\r\n               <select \r\n                  className=\"w-full bg-slate-700 border border-slate-600 rounded p-2 text-white outline-none focus:border-indigo-500\"\r\n                  value={data.target}\r\n                  onChange={e => setData({...data, target: e.target.value})}\r\n               >\r\n                  <option value=\"_blank\">Nova janela</option>\r\n                  <option value=\"_self\">Mesma janela</option>\r\n               </select>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"flex justify-end gap-2 px-4 py-3 bg-slate-900 border-t border-slate-700\">\r\n           <button onClick={onClose} className=\"px-4 py-2 text-slate-300 hover:text-white font-medium text-sm transition-colors\">Cancelar</button>\r\n           <button onClick={() => { onSave(data); onClose(); }} className=\"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded font-medium text-sm transition-colors shadow-lg\">Ok</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// =============================================================================\r\n// 3. PAINEL DE PROPRIEDADES (O componente que faltava!)\r\n// =============================================================================\r\n\r\nconst PropertiesPanel = ({ selectedBlock, editor }: { selectedBlock: any, editor: any }) => {\r\n  const [, setTick] = useState(0);\r\n  const [expandPadding, setExpandPadding] = useState(false);\r\n  const [forceCustomLH, setForceCustomLH] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (!selectedBlock) return;\r\n    const update = () => setTick(t => t + 1);\r\n    \r\n    selectedBlock.on('change:attributes', update);\r\n    selectedBlock.on('change:style', update);\r\n    \r\n    const attrs = selectedBlock.getAttributes();\r\n    if (attrs['padding-top'] || attrs['padding-bottom'] || attrs['padding-left'] || attrs['padding-right']) {\r\n        setExpandPadding(true);\r\n    } else {\r\n        setExpandPadding(false);\r\n    }\r\n    \r\n    setForceCustomLH(false);\r\n\r\n    return () => { \r\n        selectedBlock.off('change:attributes', update); \r\n        selectedBlock.off('change:style', update);\r\n    };\r\n  }, [selectedBlock]);\r\n\r\n  if (!selectedBlock) return <div className=\"flex flex-col items-center justify-center h-full text-gray-400 p-8 text-center bg-gray-50/50\"><MousePointerClick size={48} className=\"mb-4 opacity-20\" /><p className=\"text-sm font-medium\">Selecione um elemento</p></div>;\r\n\r\n  const attributes = selectedBlock.getAttributes();\r\n  const tagName = selectedBlock.get('tagName');\r\n\r\n  const update = (key: string, value: string) => { \r\n      selectedBlock.addAttributes({ [key]: value }); \r\n      setTick(t => t + 1); \r\n  };\r\n\r\n  const getVal = (attr: string, def = '0') => { \r\n      const val = attributes[attr]; \r\n      return val ? val.replace('px', '') : def; \r\n  };\r\n\r\n  const handlePadding = (side: string | null, val: any) => {\r\n      if (side === 'all') {\r\n          selectedBlock.addAttributes({ 'padding': `${val}px`, 'padding-top': '', 'padding-bottom': '', 'padding-left': '', 'padding-right': '' });\r\n          selectedBlock.removeStyle(['padding-top', 'padding-bottom', 'padding-left', 'padding-right']);\r\n      } else {\r\n          selectedBlock.addAttributes({ [`padding-${side}`]: `${val}px` });\r\n      }\r\n      setTick(t => t + 1);\r\n  };\r\n\r\n  const getPad = (side: string) => {\r\n      let val = attributes[`padding-${side}`];\r\n      if (!val && attributes['padding']) {\r\n          const parts = attributes['padding'].split(' ');\r\n          if (parts.length === 1) val = parts[0];\r\n          else if (parts.length === 4) { \r\n             if(side==='top') val=parts[0]; \r\n             if(side==='right') val=parts[1]; \r\n             if(side==='bottom') val=parts[2]; \r\n             if(side==='left') val=parts[3]; \r\n          }\r\n      }\r\n      return val ? val.replace('px', '') : '0';\r\n  };\r\n\r\n  const getGenPad = () => attributes['padding'] ? attributes['padding'].split(' ')[0].replace('px', '') : '0';\r\n\r\n  // --- RENDERIZADORES ---\r\n\r\n  if (['mj-text', 'custom-title', 'custom-text'].includes(tagName)) {\r\n    const rawLH = attributes['line-height']; \r\n    const currentLH = rawLH || '1.5';\r\n    const isCustomLH = !['1', '1.2', '1.5', '2'].includes(currentLH);\r\n    const showCustomInput = forceCustomLH || (isCustomLH && rawLH !== undefined);\r\n\r\n    return (\r\n      <div className=\"flex flex-col h-full bg-white font-sans\">\r\n        <div className=\"flex items-center justify-between px-5 py-4 border-b border-gray-100 bg-white\">\r\n          <span className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\"><Type size={14} className=\"text-indigo-500\"/> Texto</span>\r\n          <div className=\"flex items-center gap-1\">\r\n             <button onClick={() => {selectedBlock.clone(); editor.add(selectedBlock.clone());}} className=\"p-1.5 hover:bg-gray-100 rounded text-gray-400\"><Copy size={14}/></button>\r\n             <button onClick={() => selectedBlock.remove()} className=\"p-1.5 hover:bg-red-50 text-red-500 rounded\"><Trash2 size={14}/></button>\r\n             <button onClick={() => editor.select(null)} className=\"p-1.5 hover:bg-gray-100 rounded text-gray-400\"><X size={14}/></button>\r\n          </div>\r\n        </div>\r\n        \r\n        <div className=\"flex-1 overflow-y-auto p-5 space-y-6 custom-scrollbar\">\r\n          <div className=\"space-y-4\">\r\n              <div><Label>Fonte</Label><Select value={attributes['font-family'] || 'Arial, sans-serif'} onChange={(v: string) => update('font-family', v)} options={[{label:'Global (Arial)', value:'Arial, sans-serif'}, {label:'Helvetica', value:'Helvetica, sans-serif'}, {label:'Times', value:'Times New Roman, serif'}, {label:'Courier', value:'Courier New, monospace'}, {label:'Verdana', value:'Verdana, sans-serif'}]} /></div>\r\n              <div><Label>Espessura</Label><Select value={attributes['font-weight'] || 'normal'} onChange={(v: string) => update('font-weight', v)} options={[{label:'Regular', value:'normal'}, {label:'Bold', value:'bold'}, {label:'Light', value:'300'}, {label:'Black', value:'900'}]} /></div>\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                 <div><Label>Tamanho</Label><CounterInput value={getVal('font-size', '13')} onChange={(v: any) => update('font-size', v+'px')} /></div>\r\n                 <div>\r\n                    <Label>Line height</Label>\r\n                    <Select \r\n                      value={showCustomInput ? 'custom' : currentLH} \r\n                      onChange={(v: string) => { if(v==='custom') setForceCustomLH(true); else { setForceCustomLH(false); update('line-height', v); } }} \r\n                      options={[{label:'1', value:'1'}, {label:'1.2', value:'1.2'}, {label:'1.5', value:'1.5'}, {label:'2', value:'2'}, {label:'Custom...', value:'custom'}]} \r\n                    />\r\n                    {showCustomInput && <div className=\"mt-2\"><input type=\"text\" className=\"w-full text-xs border border-indigo-300 rounded p-1 text-center bg-indigo-50 text-indigo-700\" value={rawLH || ''} placeholder=\"Ex: 1.8\" onChange={(e) => update('line-height', e.target.value)}/></div>}\r\n                 </div>\r\n              </div>\r\n          </div>\r\n          <hr className=\"border-gray-100\" />\r\n          \r\n          <div className=\"space-y-4\">\r\n              <div><Label>Cor Texto</Label><ColorInput value={attributes['color']} onChange={(v: string) => update('color', v)} /></div>\r\n              <div><Label>Cor Link</Label><ColorInput value={attributes['link-color'] || '#0068a5'} onChange={(v: string) => update('link-color', v)} /></div>\r\n          </div>\r\n          <hr className=\"border-gray-100\" />\r\n          \r\n          <div><Label>Alinhar</Label><div className=\"flex border border-gray-200 rounded h-9\">{['left', 'center', 'right'].map((align) => (<button key={align} onClick={() => update('align', align)} className={`flex-1 flex items-center justify-center border-r last:border-r-0 ${attributes['align']===align?'bg-indigo-50 text-indigo-600':'text-gray-400'}`}>{align==='left'&&<AlignLeft size={16}/>}{align==='center'&&<AlignCenter size={16}/>}{align==='right'&&<AlignRight size={16}/>}</button>))}</div></div>\r\n          <hr className=\"border-gray-100\" />\r\n          \r\n          <div><Label>Esp. Letras</Label><CounterInput value={getVal('letter-spacing', '0')} onChange={(v: any) => update('letter-spacing', v+'px')} /></div>\r\n          \r\n          <div className=\"bg-gray-50/80 -mx-5 px-5 py-5 border-t border-gray-200 mt-2\">\r\n              <div className=\"flex items-center justify-between mb-3\"><Label>Preenchimento</Label><div className=\"flex items-center gap-2\"><span className=\"text-[10px] text-gray-400\">Mais op├º├Áes</span><Toggle checked={expandPadding} onChange={(chk: boolean) => { setExpandPadding(chk); if(!chk) handlePadding('all', getPad('top')); else { const c = getGenPad(); selectedBlock.addAttributes({'padding-top':`${c}px`,'padding-bottom':`${c}px`,'padding-left':`${c}px`,'padding-right':`${c}px`}); }}} /></div></div>\r\n              {expandPadding ? (\r\n                  <div className=\"flex gap-4\"><div className=\"grid grid-cols-2 gap-3 flex-1\"><div><Label>Top</Label><CounterInput value={getPad('top')} onChange={(v:any)=>handlePadding('top', v)}/></div><div><Label>Right</Label><CounterInput value={getPad('right')} onChange={(v:any)=>handlePadding('right', v)}/></div><div><Label>Bottom</Label><CounterInput value={getPad('bottom')} onChange={(v:any)=>handlePadding('bottom', v)}/></div><div><Label>Left</Label><CounterInput value={getPad('left')} onChange={(v:any)=>handlePadding('left', v)}/></div></div></div>\r\n              ) : (\r\n                  <div className=\"grid grid-cols-2 gap-4\"><div><Label>Todos</Label><CounterInput value={getGenPad()} onChange={(v:any)=>handlePadding('all', v)}/></div></div>\r\n              )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex flex-col h-full bg-white font-sans\">\r\n        <div className=\"flex items-center justify-between px-5 py-4 border-b border-gray-100 bg-white\">\r\n           <span className=\"text-xs font-bold text-gray-600 uppercase tracking-wider flex items-center gap-2\"><MousePointerClick size={14}/> Propriedades</span>\r\n           <button onClick={() => editor.select(null)} className=\"p-1.5 hover:bg-gray-100 rounded text-gray-400\"><X size={14}/></button>\r\n        </div>\r\n        <div className=\"p-5 space-y-4\">\r\n             {tagName === 'mj-section' && (<><div><Label>Cor de Fundo</Label><ColorInput value={attributes['background-color']} onChange={(v:string) => update('background-color', v)} /></div><div><Label>Padding</Label><CounterInput value={getVal('padding')} onChange={(v:any) => update('padding', v+'px')} /></div></>)}\r\n             {tagName === 'mj-button' && (<><div><Label>Link</Label><input className=\"w-full border rounded p-2 text-sm\" value={attributes['href'] || ''} onChange={(e) => update('href', e.target.value)} /></div><div><Label>Cor Fundo</Label><ColorInput value={attributes['background-color']} onChange={(v:string) => update('background-color', v)} /></div><div><Label>Cor Texto</Label><ColorInput value={attributes['color']} onChange={(v:string) => update('color', v)} /></div></>)}\r\n             {tagName === 'mj-image' && (<><div><Label>Src</Label><input className=\"w-full border rounded p-2 text-sm\" value={attributes['src'] || ''} onChange={(e) => update('src', e.target.value)} /></div><div><Label>Link</Label><input className=\"w-full border rounded p-2 text-sm\" value={attributes['href'] || ''} onChange={(e) => update('href', e.target.value)} /></div></>)}\r\n             {!['mj-section', 'mj-text', 'custom-title', 'custom-text', 'mj-button', 'mj-image'].includes(tagName) && <p className=\"text-sm text-gray-400\">Sem op├º├Áes r├ípidas para este bloco.</p>}\r\n        </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// =============================================================================\r\n// 4. EDITOR PRINCIPAL (ATUALIZADO)\r\n// =============================================================================\r\n\r\ninterface EmailEditorProps {\r\n  initialData?: any; // JSON do GrapesJS\r\n  onSave: (html: string, json: any) => void; // Callback quando salva\r\n  onClose: () => void; // Callback quando cancela/volta\r\n}\r\n\r\nconst EmailEditor: React.FC<EmailEditorProps> = ({ initialData, onSave, onClose }) => {\r\n  const editorRef = useRef<HTMLDivElement>(null);\r\n  const [editor, setEditor] = useState<any>(null);\r\n  const [selectedBlock, setSelectedBlock] = useState<any>(null);\r\n  const [linkModalOpen, setLinkModalOpen] = useState(false);\r\n  const [currentLinkData, setCurrentLinkData] = useState<any>(null);\r\n\r\n  // Efeito de Inicializa├º├úo\r\n  useEffect(() => {\r\n    if (!editorRef.current) return;\r\n\r\n    const blocksContainer = document.getElementById('blocks-container');\r\n    if (blocksContainer) blocksContainer.innerHTML = '';\r\n\r\n    const editorInstance = grapesjs.init({\r\n      container: editorRef.current,\r\n      height: '100%',\r\n      width: '100%',\r\n      storageManager: false,\r\n      plugins: [grapesjsMjml],\r\n      pluginsOpts: { 'grapesjs-mjml': {} },\r\n      richTextEditor: { \r\n        actions: ['bold', 'italic', 'underline', 'strikethrough', 'link', 'wrap'],\r\n      },\r\n      blockManager: { appendTo: '#blocks-container' },\r\n      panels: { defaults: [] },\r\n    });\r\n\r\n    const bm = editorInstance.BlockManager;\r\n    bm.add('mj-section', { label: 'Se├º├úo', content: `<mj-section padding=\"20px\" background-color=\"#ffffff\"><mj-column><mj-text>Se├º├úo</mj-text></mj-column></mj-section>`, attributes: { class: 'fa fa-columns' } });\r\n    bm.add('custom-title', { label: 'T├¡tulo', content: `<mj-text font-size=\"24px\" font-weight=\"bold\" align=\"center\" color=\"#333333\">T├¡tulo</mj-text>`, attributes: { class: 'fa fa-heading' } });\r\n    bm.add('custom-text', { label: 'Texto', content: `<mj-text font-size=\"14px\" color=\"#555555\" line-height=\"1.5\">Par├ígrafo</mj-text>`, attributes: { class: 'fa fa-paragraph' } });\r\n    bm.add('custom-button', { label: 'Bot├úo', content: `<mj-button background-color=\"#4f46e5\" color=\"#ffffff\" border-radius=\"4px\">Clique</mj-button>`, attributes: { class: 'fa fa-square' } });\r\n    bm.add('custom-image', { label: 'Imagem', content: `<mj-image src=\"https://via.placeholder.com/350x150\" />`, attributes: { class: 'fa fa-image' } });\r\n\r\n    const rte = editorInstance.RichTextEditor;\r\n    if (rte) {\r\n        rte.add('ul', { icon: '<b class=\"fa fa-list-ul\">UL</b>', attributes: {title:'Lista'}, result: (rte:any) => rte.exec('insertUnorderedList') });\r\n        rte.add('ol', { icon: '<b class=\"fa fa-list-ol\">OL</b>', attributes: {title:'Lista Num.'}, result: (rte:any) => rte.exec('insertOrderedList') });\r\n        rte.add('justifyLeft', { icon: '<b class=\"fa fa-align-left\">L</b>', result: (rte:any) => rte.exec('justifyLeft') });\r\n        rte.add('justifyCenter', { icon: '<b class=\"fa fa-align-center\">C</b>', result: (rte:any) => rte.exec('justifyCenter') });\r\n        rte.add('justifyRight', { icon: '<b class=\"fa fa-align-right\">R</b>', result: (rte:any) => rte.exec('justifyRight') });\r\n        rte.add('link', {\r\n            icon: '<b class=\"fa fa-link\">­ƒöù</b>',\r\n            attributes: { title: 'Inserir Link' },\r\n            result: (rte: any) => {\r\n                const doc = editorInstance.Canvas.getDocument();\r\n                const selection = doc.getSelection ? doc.getSelection() : null;\r\n                const selectedText = selection ? selection.toString() : '';\r\n                setLinkModalOpen(true);\r\n                setCurrentLinkData({ content: selectedText, href: '', target: '_blank' });\r\n            }\r\n        });\r\n    }\r\n\r\n    editorInstance.on('component:selected', (c) => setSelectedBlock(c));\r\n    editorInstance.on('component:deselected', () => setSelectedBlock(null));\r\n    \r\n    // --- COMANDO SAVE (VERS├âO BLINDADA) ---\r\n    editorInstance.Commands.add('save-db', {\r\n      run: (ed) => { \r\n        // 1. Pega o JSON (Desenho do layout) - Isso nunca falha\r\n        const json = ed.getProjectData();\r\n        \r\n        // 2. Tenta gerar o HTML final com seguran├ºa m├íxima\r\n        let html = '';\r\n        \r\n        try {\r\n            // Executa o comando do MJML\r\n            const result = ed.runCommand('mjml-get-code');\r\n            \r\n            // Verifica manualmente se o resultado existe E se tem a propriedade html\r\n            if (result && typeof result.html === 'string') {\r\n                html = result.html;\r\n            } else {\r\n                // Se der undefined, usa o HTML padr├úo do GrapesJS\r\n                console.warn('Plugin MJML n├úo retornou HTML. Usando fallback.');\r\n                html = ed.getHtml();\r\n            }\r\n        } catch (error) {\r\n            // Se der qualquer erro fatal, captura aqui e n├úo quebra a tela\r\n            console.error('Erro ao gerar HTML:', error);\r\n            html = ed.getHtml() || '<div>Erro ao gerar HTML</div>';\r\n        }\r\n\r\n        console.log('Dados prontos para salvar. Tamanho HTML:', html.length);\r\n\r\n        // 3. Envia para a p├ígina pai\r\n        onSave(html, json);\r\n      }\r\n    });\r\n\r\n    if (initialData && Object.keys(initialData).length > 0) {\r\n      editorInstance.loadProjectData(initialData);\r\n    } else if (!initialData) {\r\n       editorInstance.addComponents(`\r\n        <mjml>\r\n          <mj-body background-color=\"#f8f9fa\" width=\"600px\">\r\n            <mj-section padding=\"20px\" background-color=\"#ffffff\">\r\n              <mj-column>\r\n                <mj-text align=\"center\" font-size=\"24px\">Comece a editar</mj-text>\r\n              </mj-column>\r\n            </mj-section>\r\n          </mj-body>\r\n        </mjml>\r\n      `);\r\n    }\r\n\r\n    setEditor(editorInstance);\r\n\r\n    return () => {\r\n      editorInstance.destroy();\r\n    };\r\n  }, []); \r\n\r\n  const handleLinkSave = (data: any) => {\r\n      if (!editor) return;\r\n      const rte = editor.RichTextEditor;\r\n      if (!rte) return;\r\n\r\n      const style = data.underline ? 'text-decoration: underline;' : 'text-decoration: none;';\r\n      const textToShow = data.text || currentLinkData?.content || 'link';\r\n      const linkHtml = `<a href=\"${data.url}\" target=\"${data.target}\" title=\"${data.title}\" style=\"color: inherit; ${style}\">${textToShow}</a>`;\r\n      \r\n      rte.insertHTML(linkHtml);\r\n  };\r\n\r\n  return (\r\n    <div className=\"flex h-screen w-full fixed inset-0 z-50 bg-white font-sans\">\r\n      <LinkModal \r\n        isOpen={linkModalOpen} \r\n        onClose={() => setLinkModalOpen(false)} \r\n        onSave={handleLinkSave}\r\n        initialData={currentLinkData}\r\n      />\r\n      \r\n      {/* Sidebar Esquerda (Componentes) */}\r\n      <div className=\"w-64 bg-white border-r border-gray-200 flex flex-col shrink-0 z-10\">\r\n        <div className=\"h-14 flex items-center px-4 border-b border-gray-200 bg-gray-50\">\r\n           <button onClick={onClose} className=\"flex items-center text-gray-500 hover:text-gray-800 text-sm font-medium gap-1\">\r\n             <ArrowLeft size={16} /> Voltar\r\n           </button>\r\n        </div>\r\n        <div className=\"p-3 bg-gray-50 text-xs font-bold text-gray-500 uppercase tracking-wider\">\r\n          Arrastar Componentes\r\n        </div>\r\n        <div id=\"blocks-container\" className=\"flex-1 overflow-y-auto p-3 space-y-3 custom-scrollbar\"></div>\r\n      </div>\r\n      \r\n      {/* ├ürea Central (Canvas) */}\r\n      <div className=\"flex-1 flex flex-col bg-gray-100 relative min-w-0\">\r\n        {/* Header do Editor */}\r\n        <div className=\"h-14 bg-white border-b border-gray-200 px-4 flex justify-between items-center shadow-sm z-20\">\r\n             <div className=\"text-sm font-semibold text-gray-700\">Editando E-mail</div>\r\n             <button \r\n               onClick={() => editor?.runCommand('save-db')} \r\n               className=\"bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded text-sm font-bold transition-all shadow-sm hover:shadow\"\r\n             >\r\n               Salvar e Finalizar\r\n             </button>\r\n        </div>\r\n        \r\n        {/* Canvas GrapesJS */}\r\n        <div className=\"flex-1 relative overflow-hidden\">\r\n           <div ref={editorRef} className=\"h-full w-full\" />\r\n        </div>\r\n      </div>\r\n      \r\n      {/* Sidebar Direita (Propriedades) */}\r\n      <div className=\"w-80 bg-white border-l border-gray-200 flex flex-col shrink-0 z-10 shadow-xl h-full\">\r\n         {selectedBlock ? (\r\n             <PropertiesPanel selectedBlock={selectedBlock} editor={editor} />\r\n         ) : (\r\n             <div className=\"flex flex-col items-center justify-center h-full text-gray-400 p-8 text-center\">\r\n                <MousePointerClick size={48} className=\"mb-4 opacity-20\" />\r\n                <p className=\"text-sm\">Selecione um elemento no e-mail para editar suas propriedades.</p>\r\n             </div>\r\n         )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default EmailEditor;","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx","messages":[{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:751:30\n  749 |                     <thead className=\"bg-slate-50 border-b border-slate-100\">\n  750 |                         <tr>\n> 751 |                             <SortHeader label=\"Loja\" k=\"name\" />\n      |                              ^^^^^^^^^^ This component is created during render\n  752 |                             <SortHeader label=\"Receita\" k=\"revenue\" />\n  753 |                             <SortHeader label=\"Influ├¬ncia\" k=\"revenueInfluenced\" />\n  754 |                             <SortHeader label=\"Transa├º├Áes\" k=\"transactions\" />\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:732:24\n  730 |     }, [stores, deferredSearch, page, perPage, sortConfig]);\n  731 |\n> 732 |     const SortHeader = ({ label, k, align = \"left\" }: any) => (\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 733 |         <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 734 |             <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 735 |                 {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 736 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 737 |         </th>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 738 |     );\n      | ^^^^^^ The component is created during render here\n  739 |\n  740 |     return (\n  741 |         <section>","line":751,"column":30,"nodeType":null,"endLine":751,"endColumn":40},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:752:30\n  750 |                         <tr>\n  751 |                             <SortHeader label=\"Loja\" k=\"name\" />\n> 752 |                             <SortHeader label=\"Receita\" k=\"revenue\" />\n      |                              ^^^^^^^^^^ This component is created during render\n  753 |                             <SortHeader label=\"Influ├¬ncia\" k=\"revenueInfluenced\" />\n  754 |                             <SortHeader label=\"Transa├º├Áes\" k=\"transactions\" />\n  755 |                             <SortHeader label=\"Recompra\" k=\"repurchase\" align=\"center\" />\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:732:24\n  730 |     }, [stores, deferredSearch, page, perPage, sortConfig]);\n  731 |\n> 732 |     const SortHeader = ({ label, k, align = \"left\" }: any) => (\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 733 |         <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 734 |             <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 735 |                 {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 736 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 737 |         </th>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 738 |     );\n      | ^^^^^^ The component is created during render here\n  739 |\n  740 |     return (\n  741 |         <section>","line":752,"column":30,"nodeType":null,"endLine":752,"endColumn":40},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:753:30\n  751 |                             <SortHeader label=\"Loja\" k=\"name\" />\n  752 |                             <SortHeader label=\"Receita\" k=\"revenue\" />\n> 753 |                             <SortHeader label=\"Influ├¬ncia\" k=\"revenueInfluenced\" />\n      |                              ^^^^^^^^^^ This component is created during render\n  754 |                             <SortHeader label=\"Transa├º├Áes\" k=\"transactions\" />\n  755 |                             <SortHeader label=\"Recompra\" k=\"repurchase\" align=\"center\" />\n  756 |                             <SortHeader label=\"PA\" k=\"itemsPerTicket\" align=\"center\" />\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:732:24\n  730 |     }, [stores, deferredSearch, page, perPage, sortConfig]);\n  731 |\n> 732 |     const SortHeader = ({ label, k, align = \"left\" }: any) => (\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 733 |         <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 734 |             <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 735 |                 {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 736 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 737 |         </th>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 738 |     );\n      | ^^^^^^ The component is created during render here\n  739 |\n  740 |     return (\n  741 |         <section>","line":753,"column":30,"nodeType":null,"endLine":753,"endColumn":40},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:754:30\n  752 |                             <SortHeader label=\"Receita\" k=\"revenue\" />\n  753 |                             <SortHeader label=\"Influ├¬ncia\" k=\"revenueInfluenced\" />\n> 754 |                             <SortHeader label=\"Transa├º├Áes\" k=\"transactions\" />\n      |                              ^^^^^^^^^^ This component is created during render\n  755 |                             <SortHeader label=\"Recompra\" k=\"repurchase\" align=\"center\" />\n  756 |                             <SortHeader label=\"PA\" k=\"itemsPerTicket\" align=\"center\" />\n  757 |                             <SortHeader label=\"Ticket M├®dio\" k=\"ticket\" align=\"right\" />\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:732:24\n  730 |     }, [stores, deferredSearch, page, perPage, sortConfig]);\n  731 |\n> 732 |     const SortHeader = ({ label, k, align = \"left\" }: any) => (\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 733 |         <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 734 |             <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 735 |                 {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 736 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 737 |         </th>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 738 |     );\n      | ^^^^^^ The component is created during render here\n  739 |\n  740 |     return (\n  741 |         <section>","line":754,"column":30,"nodeType":null,"endLine":754,"endColumn":40},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:755:30\n  753 |                             <SortHeader label=\"Influ├¬ncia\" k=\"revenueInfluenced\" />\n  754 |                             <SortHeader label=\"Transa├º├Áes\" k=\"transactions\" />\n> 755 |                             <SortHeader label=\"Recompra\" k=\"repurchase\" align=\"center\" />\n      |                              ^^^^^^^^^^ This component is created during render\n  756 |                             <SortHeader label=\"PA\" k=\"itemsPerTicket\" align=\"center\" />\n  757 |                             <SortHeader label=\"Ticket M├®dio\" k=\"ticket\" align=\"right\" />\n  758 |                         </tr>\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:732:24\n  730 |     }, [stores, deferredSearch, page, perPage, sortConfig]);\n  731 |\n> 732 |     const SortHeader = ({ label, k, align = \"left\" }: any) => (\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 733 |         <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 734 |             <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 735 |                 {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 736 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 737 |         </th>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 738 |     );\n      | ^^^^^^ The component is created during render here\n  739 |\n  740 |     return (\n  741 |         <section>","line":755,"column":30,"nodeType":null,"endLine":755,"endColumn":40},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:756:30\n  754 |                             <SortHeader label=\"Transa├º├Áes\" k=\"transactions\" />\n  755 |                             <SortHeader label=\"Recompra\" k=\"repurchase\" align=\"center\" />\n> 756 |                             <SortHeader label=\"PA\" k=\"itemsPerTicket\" align=\"center\" />\n      |                              ^^^^^^^^^^ This component is created during render\n  757 |                             <SortHeader label=\"Ticket M├®dio\" k=\"ticket\" align=\"right\" />\n  758 |                         </tr>\n  759 |                     </thead>\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:732:24\n  730 |     }, [stores, deferredSearch, page, perPage, sortConfig]);\n  731 |\n> 732 |     const SortHeader = ({ label, k, align = \"left\" }: any) => (\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 733 |         <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 734 |             <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 735 |                 {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 736 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 737 |         </th>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 738 |     );\n      | ^^^^^^ The component is created during render here\n  739 |\n  740 |     return (\n  741 |         <section>","line":756,"column":30,"nodeType":null,"endLine":756,"endColumn":40},{"ruleId":"react-hooks/static-components","severity":2,"message":"Error: Cannot create components during render\n\nComponents created during render will reset their state each time they are created. Declare components outside of render.\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:757:30\n  755 |                             <SortHeader label=\"Recompra\" k=\"repurchase\" align=\"center\" />\n  756 |                             <SortHeader label=\"PA\" k=\"itemsPerTicket\" align=\"center\" />\n> 757 |                             <SortHeader label=\"Ticket M├®dio\" k=\"ticket\" align=\"right\" />\n      |                              ^^^^^^^^^^ This component is created during render\n  758 |                         </tr>\n  759 |                     </thead>\n  760 |                     <tbody className=\"divide-y divide-slate-100\">\n\nC:\\Users\\danie\\OneDrive\\Documentos\\CRM-PROJETO\\frontend\\app\\results\\retail\\page.tsx:732:24\n  730 |     }, [stores, deferredSearch, page, perPage, sortConfig]);\n  731 |\n> 732 |     const SortHeader = ({ label, k, align = \"left\" }: any) => (\n      |                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 733 |         <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 734 |             <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 735 |                 {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 736 |             </div>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 737 |         </th>\n      | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n> 738 |     );\n      | ^^^^^^ The component is created during render here\n  739 |\n  740 |     return (\n  741 |         <section>","line":757,"column":30,"nodeType":null,"endLine":757,"endColumn":40}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport React, { useEffect, useState, useMemo, useRef, useDeferredValue } from 'react';\r\nimport {\r\n    Home, Users, BarChart2, MessageCircle, Target, Calendar, Bell,\r\n    ShoppingBag, TrendingUp, DollarSign, ArrowUp, ArrowDown, RefreshCw, Activity, Wallet,\r\n    Download, Search, ChevronDown, Smartphone, Mail, CalendarDays, Zap, Layers, Check,\r\n    ChevronLeft, ChevronRight, Filter, Store, X, FileText, PieChart as PieIcon, Info\r\n} from 'lucide-react';\r\nimport Link from 'next/link';\r\nimport {\r\n    LineChart, Line, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, PieChart, Pie, Cell, Legend, Area, AreaChart\r\n} from 'recharts';\r\nimport { API_BASE_URL } from \"@/lib/config\";\r\n\r\n// --- CONSTANTES GLOBAIS ---\r\nconst COLORS = {\r\n    primary: \"#6366f1\",   // Violeta\r\n    secondary: \"#0f172a\", // Slate Dark\r\n    accent: \"#f59e0b\",    // Amber/Laranja\r\n    success: \"#10b981\",   // Emerald\r\n    danger: \"#ef4444\",    // Red\r\n    neutral: \"#94a3b8\",   // Gray\r\n    grid: \"#e2e8f0\"\r\n};\r\n\r\nconst CHANNEL_ICONS: any = {\r\n    'Agenda': <CalendarDays size={24} />,\r\n    'SMS': <Smartphone size={24} />,\r\n    'E-mail': <Mail size={24} />,\r\n    'WhatsApp': <MessageCircle size={24} />,\r\n    'Agenda + SMS': <Zap size={24} />,\r\n    'Agenda + E-mail': <Layers size={24} />,\r\n    'Outros': <Target size={24} />\r\n};\r\n\r\n/**\r\n * Retail Results Page.\r\n * Displays a comprehensive dashboard for retail performance metrics.\r\n * \r\n * Features:\r\n * - Date range filtering (Presets: Today, Last Year)\r\n * - Store filtering\r\n * - KPI Cards (Revenue, Sales Volume, Avg Ticket, Repurchase Rate)\r\n * - Visualizations: Line Charts (Trend), Bar Charts (Segmentation), Pie/Area Charts (Revenue Attribution)\r\n */\r\nexport default function RetailResultsPage() {\r\n    const [data, setData] = useState<any>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // --- ESTADOS ---\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const lastYear = new Date(new Date().setFullYear(new Date().getFullYear() - 1)).toISOString().split('T')[0];\r\n\r\n    const [dateRange, setDateRange] = useState({ start: lastYear, end: today });\r\n    const [draftDate, setDraftDate] = useState({ start: lastYear, end: today });\r\n    const [selectedStores, setSelectedStores] = useState<string[]>([]);\r\n    const [draftStores, setDraftStores] = useState<string[]>([]);\r\n    const [availableStores, setAvailableStores] = useState<any[]>([]);\r\n\r\n    const [isDateOpen, setIsDateOpen] = useState(false);\r\n    const [isFilterMenuOpen, setIsFilterMenuOpen] = useState(false);\r\n\r\n    const [selectedMetric, setSelectedMetric] = useState('revenue');\r\n    const [selectedProfile, setSelectedProfile] = useState('avgSpend');\r\n    const [viewMode, setViewMode] = useState<'mensal' | 'trimestral'>('mensal');\r\n    const [impactViewMode, setImpactViewMode] = useState<'mensal' | 'trimestral'>('mensal');\r\n    const [groupMode, setGroupMode] = useState<'people' | 'revenue'>('people');\r\n\r\n    const [isChannelFilterOpen, setIsChannelFilterOpen] = useState(false);\r\n    const PRIMITIVE_CHANNELS = ['Agenda', 'SMS', 'E-mail', 'WhatsApp', 'Mobile Push'];\r\n    const [activeFilters, setActiveFilters] = useState<string[]>([...PRIMITIVE_CHANNELS]);\r\n    const [staticStores, setStaticStores] = useState<any[]>([]);\r\n\r\n    const dateRef = useRef<HTMLDivElement>(null);\r\n    const globalFilterRef = useRef<HTMLDivElement>(null);\r\n    const channelFilterRef = useRef<HTMLDivElement>(null);\r\n\r\n    /**\r\n     * Fetches retail metrics from the API.\r\n     * \r\n     * @param start Start date (YYYY-MM-DD)\r\n     * @param end End date (YYYY-MM-DD)\r\n     * @param stores Array of Store IDs to filter by\r\n     */\r\n    async function fetchData(start: string, end: string, stores: string[]) {\r\n        setLoading(true);\r\n        try {\r\n            const storesQuery = stores.length > 0 ? `&stores=${stores.join(',')}` : '';\r\n            const url = `${API_BASE_URL}/sales/retail-metrics?start=${start}&end=${end}${storesQuery}`;\r\n            const res = await fetch(url, { cache: 'no-store' });\r\n            if (!res.ok) throw new Error(\"Erro API\");\r\n            const json = await res.json();\r\n            setData(json);\r\n            setStaticStores(json.stores || []);\r\n        } catch (error) { console.error(error); }\r\n        finally { setLoading(false); }\r\n    }\r\n\r\n    useEffect(() => {\r\n        async function loadStores() {\r\n            try {\r\n                const res = await fetch(`${API_BASE_URL}/webhook/erp/stores`);\r\n                if (res.ok) setAvailableStores(await res.json());\r\n            } catch (e) { console.error(e); }\r\n        }\r\n        loadStores();\r\n    }, []);\r\n\r\n    useEffect(() => { fetchData(dateRange.start, dateRange.end, selectedStores); }, []);\r\n\r\n    useEffect(() => {\r\n        function handleClickOutside(event: MouseEvent) {\r\n            if (dateRef.current && !dateRef.current.contains(event.target as Node)) setIsDateOpen(false);\r\n            if (globalFilterRef.current && !globalFilterRef.current.contains(event.target as Node)) setIsFilterMenuOpen(false);\r\n            if (isChannelFilterOpen && channelFilterRef.current && !channelFilterRef.current.contains(event.target as Node)) setIsChannelFilterOpen(false);\r\n        }\r\n        document.addEventListener(\"mousedown\", handleClickOutside);\r\n        return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    }, [isChannelFilterOpen, isDateOpen, isFilterMenuOpen]);\r\n\r\n    // Actions\r\n    const handleApplyGlobalFilters = () => {\r\n        setDateRange(draftDate);\r\n        setSelectedStores(draftStores);\r\n        setIsDateOpen(false);\r\n        setIsFilterMenuOpen(false);\r\n        fetchData(draftDate.start, draftDate.end, draftStores);\r\n    };\r\n\r\n    const handleClearFilters = () => {\r\n        const defaultStart = lastYear;\r\n        const defaultEnd = today;\r\n        setDraftDate({ start: defaultStart, end: defaultEnd });\r\n        setDraftStores([]);\r\n        setDateRange({ start: defaultStart, end: defaultEnd });\r\n        setSelectedStores([]);\r\n        fetchData(defaultStart, defaultEnd, []);\r\n    };\r\n\r\n    const toggleStoreSelection = (id: string) => {\r\n        if (draftStores.includes(id)) setDraftStores(draftStores.filter(s => s !== id));\r\n        else setDraftStores([...draftStores, id]);\r\n    };\r\n\r\n    const toggleChannelFilter = (ch: string) => {\r\n        setActiveFilters(prev => prev.includes(ch) ? prev.filter(f => f !== ch) : [...prev, ch]);\r\n    };\r\n\r\n    const formatDateDisplay = (iso: string) => {\r\n        if (!iso) return '';\r\n        const [y, m, d] = iso.split('-');\r\n        return `${d}/${m}/${y}`;\r\n    }\r\n\r\n    // --- L├ôGICA DE DADOS ---\r\n    /**\r\n     * Processes raw data for visualization based on the selected view mode.\r\n     * \r\n     * @param mode 'mensal' (Monthly) or 'trimestral' (Quarterly) aggregation.\r\n     * @returns Processed data array for Recharts.\r\n     */\r\n    const processData = (mode: 'mensal' | 'trimestral') => {\r\n        if (!data) return [];\r\n\r\n        // MODO MENSAL\r\n        if (mode === 'mensal') {\r\n            return data.history.map((item: any) => ({\r\n                ...item,\r\n                revenueOrganic: item.revenue - item.revenueInfluenced\r\n            }));\r\n        }\r\n\r\n        // MODO TRIMESTRAL (Agrega├º├úo)\r\n        const groupedData: any = {};\r\n\r\n        data.history.forEach((item: any, index: number) => {\r\n            const quarterIndex = Math.floor(index / 3) + 1;\r\n            const year = item.name.split(' ')[1] || '';\r\n            const label = `Trim ${quarterIndex} ${year}`;\r\n\r\n            if (!groupedData[label]) {\r\n                groupedData[label] = {\r\n                    name: label, count: 0,\r\n                    revenue: 0, revenueLastYear: 0, transactions: 0, revenueInfluenced: 0,\r\n                    groupNew: 0, groupRecurrent: 0, groupRecovered: 0,\r\n                    consumers: 0, consumersActive: 0,\r\n                    accTicket: 0, accRepurchase: 0, accAvgSpend: 0, accInterval: 0, accFrequency: 0\r\n                };\r\n            }\r\n\r\n            const g = groupedData[label];\r\n            g.revenue += item.revenue || 0;\r\n            g.revenueLastYear += item.revenueLastYear || 0;\r\n            g.transactions += item.transactions || 0;\r\n            g.revenueInfluenced += item.revenueInfluenced || 0;\r\n            g.groupNew += item.groupNew || 0;\r\n            g.groupRecurrent += item.groupRecurrent || 0;\r\n            g.groupRecovered += item.groupRecovered || 0;\r\n\r\n            g.consumers += item.consumers || 0;\r\n            g.consumersActive += item.consumersActive || 0;\r\n            g.accTicket += item.ticket || 0;\r\n            g.accRepurchase += Number(item.repurchase) || 0;\r\n            g.accAvgSpend += item.avgSpend || 0;\r\n            g.accInterval += item.interval || 0;\r\n            g.accFrequency += item.frequency || 0;\r\n\r\n            g.count++;\r\n        });\r\n\r\n        return Object.values(groupedData).map((g: any) => ({\r\n            ...g,\r\n            revenueOrganic: g.revenue - g.revenueInfluenced,\r\n            ticket: g.count ? Math.round(g.revenue / g.transactions) : 0,\r\n            itemsPerTicket: g.count ? (g.transactions > 0 ? (g.revenue / g.transactions / 150).toFixed(2) : 0) : 0,\r\n            repurchase: g.count ? (g.accRepurchase / g.count).toFixed(1) : 0,\r\n            avgSpend: g.count ? Math.round(g.accAvgSpend / g.count) : 0,\r\n            interval: g.count ? Math.round(g.accInterval / g.count) : 0,\r\n            frequency: g.count ? (g.accFrequency / g.count).toFixed(2) : 0,\r\n            consumers: Math.round(g.consumers / g.count),\r\n            consumersActive: Math.round(g.consumersActive / g.count),\r\n            revenueNew: g.transactions > 0 ? Math.round((g.groupNew / g.transactions) * g.revenue) : 0,\r\n            revenueRecurrent: g.transactions > 0 ? Math.round((g.groupRecurrent / g.transactions) * g.revenue) : 0,\r\n            revenueRecovered: g.transactions > 0 ? Math.round((g.groupRecovered / g.transactions) * g.revenue) : 0,\r\n        }));\r\n    };\r\n\r\n    const mainGraphData = useMemo(() => processData(viewMode), [data, viewMode]);\r\n    const impactGraphData = useMemo(() => processData(impactViewMode), [data, impactViewMode]);\r\n\r\n    const donutTotals = useMemo(() => {\r\n        if (!impactGraphData.length) return { total: 0, influenced: 0, percent: \"0\" };\r\n        const total = impactGraphData.reduce((acc: number, item: any) => acc + item.revenue, 0);\r\n        const influenced = impactGraphData.reduce((acc: number, item: any) => acc + item.revenueInfluenced, 0);\r\n        return { total, influenced, percent: total > 0 ? ((influenced / total) * 100).toFixed(2) : \"0\" };\r\n    }, [impactGraphData]);\r\n\r\n    /**\r\n     * Filters and sorts channel data for display in Bento Grid and Table.\r\n     * Handles grouping of \"Other\" channels if there are too many.\r\n     */\r\n    const { visibleCards, allTableData } = useMemo(() => {\r\n        if (!data) return { visibleCards: [], allTableData: [] };\r\n        const channels = data.channels;\r\n\r\n        const eligibleChannels = channels.filter((ch: any) => {\r\n            if (ch.name === 'Outros') return true;\r\n            const parts = ch.name.split(' + ').map((p: string) => p.trim());\r\n            return parts.some((part: string) => activeFilters.includes(part));\r\n        });\r\n\r\n        const sorted = eligibleChannels.sort((a: any, b: any) => b.value - a.value);\r\n\r\n        const topChannels = sorted.filter((c: any) => c.name !== 'Outros').slice(0, 5);\r\n        const others = sorted.slice(5).concat(sorted.filter((c: any) => c.name === 'Outros'));\r\n\r\n        const finalCards = [...topChannels];\r\n        if (others.length > 0) {\r\n            const othersVal = others.reduce((acc: number, c: any) => acc + c.value, 0);\r\n            const othersPct = data.kpis.revenue > 0 ? ((othersVal / data.kpis.revenue) * 100).toFixed(2) : \"0\";\r\n            finalCards.push({ name: 'Outros Canais', value: othersVal, percent: othersPct, items: others, isOther: true });\r\n        }\r\n\r\n        return { visibleCards: finalCards, allTableData: sorted };\r\n    }, [data, activeFilters]);\r\n\r\n    if (loading) return <div className=\"flex h-screen items-center justify-center text-slate-500 font-medium bg-[#f1f5f9]\">Carregando Dashboard...</div>;\r\n    if (!data) return <div className=\"flex h-screen items-center justify-center text-slate-500 bg-[#f1f5f9]\">Sem dados dispon├¡veis.</div>;\r\n\r\n    // --- TEXTOS ---\r\n    const TEXTS = {\r\n        performance: \"Vis├úo geral dos principais indicadores financeiros da rede.\",\r\n        impacto: \"Analise quanto da sua receita veio de esfor├ºos de marketing direto.\",\r\n        carteira: \"Acompanhe a evolu├º├úo da sua base de clientes ativos vs total.\",\r\n        comportamento: \"Entenda a frequ├¬ncia, rec├¬ncia e valor monet├írio dos clientes.\",\r\n        segmentacao: \"Distribui├º├úo entre clientes novos, recorrentes e recuperados.\",\r\n        canais: \"Efici├¬ncia detalhada por canal de comunica├º├úo.\"\r\n    };\r\n\r\n    const kpiChartConfig: any = {\r\n        revenue: { prefix: \"R$\", lines: [{ key: \"revenue\", color: COLORS.primary, name: \"Receita Atual\", type: \"area\" }, { key: \"revenueLastYear\", color: COLORS.neutral, name: \"Ano Anterior\", type: \"line\" }] },\r\n        transactions: { prefix: \"\", lines: [{ key: \"transactions\", color: COLORS.secondary, name: \"Volume de Vendas\", type: \"line\" }] },\r\n        ticket: { prefix: \"R$\", lines: [{ key: \"ticket\", color: COLORS.primary, name: \"Ticket M├®dio\", type: \"line\" }, { key: \"itemsPerTicket\", color: COLORS.accent, name: \"Pe├ºas/Atendimento\", type: \"line\", yAxisId: \"right\" }] },\r\n        repurchase: { prefix: \"%\", lines: [{ key: \"repurchase\", color: COLORS.success, name: \"Taxa de Recompra\", type: \"line\" }] }\r\n    };\r\n\r\n    const profileConfig: any = {\r\n        avgSpend: { title: \"LTV (12 meses)\", color: COLORS.primary, dataKey: \"avgSpend\", prefix: \"R$\" },\r\n        interval: { title: \"Ciclo de Compra (dias)\", color: COLORS.accent, dataKey: \"interval\", prefix: \"\" },\r\n        frequency: { title: \"Frequ├¬ncia Anual\", color: COLORS.secondary, dataKey: \"frequency\", prefix: \"\" }\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex h-screen bg-[#f1f5f9] font-sans text-slate-900\">\r\n\r\n            <main className=\"flex-1 flex flex-col h-screen overflow-hidden relative\">\r\n                {/* HEADER */}\r\n                <header className=\"h-20 bg-white border-b border-slate-200 flex items-center justify-between px-8 shrink-0 sticky top-0 z-20\">\r\n                    <div>\r\n                        <h1 className=\"text-xl font-bold text-slate-800 flex items-center gap-2\">\r\n                            <span className=\"bg-violet-100 text-violet-700 p-1.5 rounded-md\"><BarChart2 size={18} /></span>\r\n                            Performance Executiva\r\n                        </h1>\r\n                    </div>\r\n                    <div className=\"flex items-center gap-3\">\r\n                        <div className=\"text-right hidden sm:block\">\r\n                            <p className=\"text-xs font-bold text-slate-700\">Admin User</p>\r\n                            <p className=\"text-[10px] text-slate-400\">Diretor Comercial</p>\r\n                        </div>\r\n                        <div className=\"w-9 h-9 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center text-slate-600 font-bold text-xs\">AD</div>\r\n                    </div>\r\n                </header>\r\n\r\n                <div className=\"flex-1 p-6 lg:p-10 overflow-auto space-y-10 scroll-smooth\">\r\n\r\n                    {/* BARRA DE FILTROS */}\r\n                    <div className=\"bg-white p-1.5 rounded-xl shadow-sm border border-slate-200 flex flex-wrap justify-between items-center pl-2 pr-2 relative z-50\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                            {/* Date Picker */}\r\n                            <div onClick={() => setIsDateOpen(!isDateOpen)} className=\"flex items-center gap-2 px-3 py-2 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 text-xs font-semibold text-slate-700 cursor-pointer transition relative\" ref={dateRef}>\r\n                                <Calendar size={14} className=\"text-violet-500\" />\r\n                                <span>{formatDateDisplay(dateRange.start)}</span>\r\n                                <span className=\"text-slate-300\">ÔåÆ</span>\r\n                                <span>{formatDateDisplay(dateRange.end)}</span>\r\n                                {isDateOpen && (\r\n                                    <div className=\"absolute top-full left-0 mt-2 bg-white border border-slate-200 rounded-lg shadow-xl p-4 w-64 z-50\" onClick={(e) => e.stopPropagation()}>\r\n                                        <div className=\"space-y-3\">\r\n                                            <div><label className=\"block text-xs text-slate-500 mb-1\">De:</label><input type=\"date\" value={draftDate.start} onChange={(e) => setDraftDate({ ...draftDate, start: e.target.value })} className=\"w-full border rounded p-1.5 text-xs outline-none focus:border-violet-500\" /></div>\r\n                                            <div><label className=\"block text-xs text-slate-500 mb-1\">At├®:</label><input type=\"date\" value={draftDate.end} onChange={(e) => setDraftDate({ ...draftDate, end: e.target.value })} className=\"w-full border rounded p-1.5 text-xs outline-none focus:border-violet-500\" /></div>\r\n                                        </div>\r\n                                        <div className=\"border-t mt-3 pt-3 flex justify-end gap-2\">\r\n                                            <button className=\"text-xs font-bold text-white bg-violet-600 hover:bg-violet-700 px-3 py-1.5 rounded\" onClick={handleApplyGlobalFilters}>Filtrar</button>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Loja Selector */}\r\n                            <div className=\"relative\" ref={globalFilterRef}>\r\n                                <div onClick={() => { setDraftStores([...selectedStores]); setIsFilterMenuOpen(!isFilterMenuOpen); }} className=\"flex items-center gap-2 px-3 py-2 bg-slate-50 hover:bg-slate-100 rounded-lg border border-slate-200 text-xs font-semibold text-slate-700 cursor-pointer transition select-none\">\r\n                                    <Store size={14} className=\"text-violet-500\" />\r\n                                    {selectedStores.length > 0 ? `${selectedStores.length} Lojas Selecionadas` : 'Todas as Lojas'}\r\n                                    <ChevronDown size={12} />\r\n                                </div>\r\n                                {isFilterMenuOpen && (\r\n                                    <div className=\"absolute top-full left-0 mt-2 w-72 bg-white border border-slate-200 rounded-lg shadow-xl p-3 z-50\">\r\n                                        <div className=\"max-h-56 overflow-y-auto space-y-1 custom-scrollbar\">\r\n                                            {availableStores.map(store => (\r\n                                                <label key={store.id} className=\"flex items-center gap-2 p-1.5 hover:bg-slate-50 rounded cursor-pointer\">\r\n                                                    <div className={`w-4 h-4 rounded border flex items-center justify-center transition-colors ${draftStores.includes(store.id) ? 'bg-violet-600 border-violet-600' : 'border-slate-300 bg-white'}`} onClick={(e) => { e.preventDefault(); toggleStoreSelection(store.id); }}>\r\n                                                        {draftStores.includes(store.id) && <Check size={10} className=\"text-white\" />}\r\n                                                    </div>\r\n                                                    <span className=\"text-xs text-slate-700 truncate font-medium\">{store.name}</span>\r\n                                                </label>\r\n                                            ))}\r\n                                        </div>\r\n                                        <div className=\"pt-2 mt-2 border-t flex justify-end\">\r\n                                            <button className=\"text-xs font-bold text-white bg-violet-600 hover:bg-violet-700 px-3 py-1.5 rounded\" onClick={handleApplyGlobalFilters}>Confirmar</button>\r\n                                        </div>\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"flex gap-2 pr-1\">\r\n                            <button onClick={handleClearFilters} className=\"text-xs text-slate-500 hover:text-slate-800 font-medium px-3 py-1.5\">Limpar</button>\r\n                            <button onClick={handleApplyGlobalFilters} className=\"bg-slate-900 text-white px-4 py-1.5 rounded-lg text-xs font-bold hover:bg-slate-800 shadow-sm transition-all\">Atualizar Dashboard</button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 1. KPIs PRINCIPAIS */}\r\n                    <section>\r\n                        <SectionTitle title=\"Indicadores de Performance\" subtitle={TEXTS.performance} />\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-5 mb-6\">\r\n                            <ModernKPICard label=\"Faturamento Total\" value={data.kpis.revenue} percent={11.69} active={selectedMetric === 'revenue'} onClick={() => setSelectedMetric('revenue')} icon={<DollarSign size={18} />} isCurrency />\r\n                            <ModernKPICard label=\"Volume de Vendas\" value={data.kpis.transactions} percent={-0.93} isRed active={selectedMetric === 'transactions'} onClick={() => setSelectedMetric('transactions')} icon={<ShoppingBag size={18} />} />\r\n                            <ModernKPICard label=\"Ticket M├®dio\" value={data.kpis.ticketAverage} percent={12.74} active={selectedMetric === 'ticket'} onClick={() => setSelectedMetric('ticket')} icon={<TrendingUp size={18} />} isCurrency />\r\n                            <ModernKPICard label=\"Taxa de Recompra\" value={data.kpis.repurchaseRate} percent={5.01} active={selectedMetric === 'repurchase'} onClick={() => setSelectedMetric('repurchase')} icon={<RefreshCw size={18} />} isPercent />\r\n                        </div>\r\n\r\n                        {/* Gr├ífico Principal */}\r\n                        <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm h-80 relative\">\r\n                            <div className=\"absolute top-6 right-6 z-10 flex gap-1 bg-slate-100 p-0.5 rounded-lg\">\r\n                                {['mensal', 'trimestral'].map((m: any) => (\r\n                                    <button key={m} onClick={() => setViewMode(m)} className={`px-3 py-1 text-[10px] font-bold rounded-md transition-all uppercase ${viewMode === m ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}>{m}</button>\r\n                                ))}\r\n                            </div>\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <LineChart data={mainGraphData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\r\n                                    <defs>\r\n                                        <linearGradient id=\"colorMetric\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                            <stop offset=\"5%\" stopColor={COLORS.primary} stopOpacity={0.1} />\r\n                                            <stop offset=\"95%\" stopColor={COLORS.primary} stopOpacity={0} />\r\n                                        </linearGradient>\r\n                                    </defs>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke={COLORS.grid} />\r\n                                    <XAxis dataKey=\"name\" axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 11, fontWeight: 500 }} dy={10} />\r\n                                    <YAxis yAxisId=\"left\" axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 11 }} tickFormatter={(val) => kpiChartConfig[selectedMetric].prefix + (val > 1000 ? val / 1000 + 'k' : val)} />\r\n                                    {selectedMetric === 'ticket' && <YAxis yAxisId=\"right\" orientation=\"right\" axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 11 }} />}\r\n                                    <Tooltip content={<CustomTooltip />} cursor={{ stroke: '#cbd5e1', strokeWidth: 1 }} />\r\n                                    <Legend verticalAlign=\"top\" height={36} iconType=\"circle\" align=\"left\" wrapperStyle={{ fontSize: '12px', fontWeight: 600, color: '#475569' }} />\r\n                                    {kpiChartConfig[selectedMetric].lines.map((line: any, idx: number) => {\r\n                                        if (line.type === 'area') return <Area key={idx} type=\"monotone\" yAxisId={line.yAxisId || 0} dataKey={line.key} name={line.name} stroke={line.color} strokeWidth={2} fill=\"url(#colorMetric)\" activeDot={{ r: 5 }} />;\r\n                                        return <Line key={idx} type=\"monotone\" yAxisId={line.yAxisId || 0} dataKey={line.key} name={line.name} stroke={line.color} strokeWidth={2} dot={false} activeDot={{ r: 5 }} />;\r\n                                    })}\r\n                                </LineChart>\r\n                            </ResponsiveContainer>\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* 2. BASE & PERFIL */}\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\r\n                        <section>\r\n                            <SectionTitle title=\"Evolu├º├úo da Carteira\" subtitle={TEXTS.carteira} />\r\n                            <div className=\"bg-white p-5 rounded-xl border border-slate-200 shadow-sm h-[380px]\">\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <LineChart data={mainGraphData}>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke={COLORS.grid} />\r\n                                        <XAxis dataKey=\"name\" axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 10 }} dy={10} />\r\n                                        <YAxis axisLine={false} tickLine={false} tick={{ fill: '#64748b', fontSize: 10 }} />\r\n                                        <Tooltip content={<CustomTooltip type=\"number\" />} />\r\n                                        <Legend verticalAlign=\"top\" iconType=\"circle\" wrapperStyle={{ fontSize: '11px', fontWeight: 600 }} />\r\n                                        <Line type=\"monotone\" dataKey=\"consumers\" name=\"Total Clientes ├Ünicos\" stroke={COLORS.secondary} strokeWidth={2} dot={false} />\r\n                                        <Line type=\"monotone\" dataKey=\"consumersActive\" name=\"Ativos (Recentes)\" stroke={COLORS.success} strokeWidth={2} dot={false} />\r\n                                    </LineChart>\r\n                                </ResponsiveContainer>\r\n                            </div>\r\n                        </section>\r\n                        <section>\r\n                            <SectionTitle title=\"Comportamento de Compra\" subtitle={TEXTS.comportamento} />\r\n                            <div className=\"bg-white p-5 rounded-xl border border-slate-200 shadow-sm h-[380px] flex flex-col\">\r\n                                <div className=\"flex gap-2 mb-4\">\r\n                                    <TabButton\r\n                                        label=\"LTV Anual\"\r\n                                        tooltip=\"Valor m├®dio gasto por cliente acumulado em 12 meses.\"\r\n                                        active={selectedProfile === 'avgSpend'}\r\n                                        onClick={() => setSelectedProfile('avgSpend')}\r\n                                    />\r\n                                    <TabButton\r\n                                        label=\"Ciclo (Dias)\"\r\n                                        tooltip=\"M├®dia de dias que um cliente recorrente leva para comprar novamente.\"\r\n                                        active={selectedProfile === 'interval'}\r\n                                        onClick={() => setSelectedProfile('interval')}\r\n                                    />\r\n                                    <TabButton\r\n                                        label=\"Frequ├¬ncia\"\r\n                                        tooltip=\"Quantidade m├®dia de compras por cliente no per├¡odo.\"\r\n                                        active={selectedProfile === 'frequency'}\r\n                                        onClick={() => setSelectedProfile('frequency')}\r\n                                    />\r\n                                </div>\r\n                                <div className=\"flex-1 w-full\">\r\n                                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                        <LineChart data={mainGraphData}>\r\n                                            <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke={COLORS.grid} />\r\n                                            <XAxis dataKey=\"name\" axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} dy={10} />\r\n                                            <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 10, fill: '#64748b' }} />\r\n                                            <Tooltip content={<CustomTooltip type={selectedProfile === 'avgSpend' ? 'currency' : 'number'} />} />\r\n                                            <Line type=\"step\" dataKey={profileConfig[selectedProfile].dataKey} stroke={profileConfig[selectedProfile].color} strokeWidth={2} dot={false} name={profileConfig[selectedProfile].title} />\r\n                                        </LineChart>\r\n                                    </ResponsiveContainer>\r\n                                </div>\r\n                            </div>\r\n                        </section>\r\n                    </div>\r\n\r\n                    {/* 4. SEGMENTA├ç├âO */}\r\n                    <section>\r\n                        <SectionTitle title=\"Segmenta├º├úo da Base\" subtitle={TEXTS.segmentacao} />\r\n                        <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm h-80 relative\">\r\n                            <div className=\"absolute top-6 right-6 z-10 flex gap-1 bg-slate-100 p-0.5 rounded-lg\">\r\n                                <button onClick={() => setGroupMode('people')} className={`px-3 py-1 text-[10px] font-bold rounded transition ${groupMode === 'people' ? 'bg-white shadow text-slate-900' : 'text-slate-400'}`}>Pessoas</button>\r\n                                <button onClick={() => setGroupMode('revenue')} className={`px-3 py-1 text-[10px] font-bold rounded transition ${groupMode === 'revenue' ? 'bg-white shadow text-slate-900' : 'text-slate-400'}`}>Receita</button>\r\n                            </div>\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <BarChart data={mainGraphData} barSize={24}>\r\n                                    <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke={COLORS.grid} />\r\n                                    <XAxis dataKey=\"name\" axisLine={false} tickLine={false} tick={{ fontSize: 11, fill: '#64748b' }} dy={10} />\r\n                                    <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 11, fill: '#64748b' }} />\r\n                                    <Tooltip content={<CustomTooltip type={groupMode === 'revenue' ? 'currency' : 'number'} />} cursor={{ fill: '#f8fafc' }} />\r\n                                    <Legend iconType=\"circle\" align=\"left\" verticalAlign=\"top\" height={36} wrapperStyle={{ fontSize: '12px' }} />\r\n                                    <Bar dataKey={groupMode === 'people' ? 'groupRecurrent' : 'revenueRecurrent'} name=\"Recorrentes\" stackId=\"a\" fill={COLORS.primary} />\r\n                                    <Bar dataKey={groupMode === 'people' ? 'groupNew' : 'revenueNew'} name=\"Novos Clientes\" stackId=\"a\" fill={COLORS.success} />\r\n                                    <Bar dataKey={groupMode === 'people' ? 'groupRecovered' : 'revenueRecovered'} name=\"Recuperados\" stackId=\"a\" fill={COLORS.neutral} />\r\n                                </BarChart>\r\n                            </ResponsiveContainer>\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* 5. ATRIBUI├ç├âO DE RECEITA (ORGANIZADO) */}\r\n                    <section>\r\n                        <SectionTitle title=\"Atribui├º├úo de Receita\" subtitle={TEXTS.impacto} />\r\n\r\n                        {/* BLOCO DE CIMA: RECEITA (DONUT + ├üREA) */}\r\n                        <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8\">\r\n                            {/* 1/3: Donut (Snapshot) */}\r\n                            <div className=\"lg:col-span-1\">\r\n                                <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col items-center justify-center h-full\">\r\n                                    <div className=\"relative w-48 h-48\">\r\n                                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                            <PieChart>\r\n                                                <Pie data={[{ value: Number(donutTotals.percent) }, { value: 100 - Number(donutTotals.percent) }]} innerRadius={60} outerRadius={75} startAngle={90} endAngle={-270} dataKey=\"value\" stroke=\"none\" paddingAngle={5}>\r\n                                                    <Cell fill={COLORS.success} /> <Cell fill=\"#f1f5f9\" />\r\n                                                </Pie>\r\n                                            </PieChart>\r\n                                        </ResponsiveContainer>\r\n                                        <div className=\"absolute inset-0 flex flex-col items-center justify-center pointer-events-none\">\r\n                                            <span className=\"text-3xl font-black text-slate-800 tracking-tighter\">{donutTotals.percent}%</span>\r\n                                            <span className=\"text-[10px] font-bold text-slate-400 uppercase\">TAXA DE INFLU├èNCIA</span>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"w-full mt-6 space-y-3\">\r\n                                        <div className=\"flex justify-between text-sm border-b border-slate-100 pb-2\">\r\n                                            <span className=\"text-slate-500\">Receita Total</span>\r\n                                            <span className=\"font-bold text-slate-700\">{donutTotals.total.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>\r\n                                        </div>\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"text-emerald-600 font-bold flex items-center gap-2\"><div className=\"w-2 h-2 rounded-full bg-emerald-500\"></div>Influenciada</span>\r\n                                            <span className=\"font-bold text-emerald-600\">{donutTotals.influenced.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' })}</span>\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* 2/3: Gr├ífico de ├ürea (Evolu├º├úo) */}\r\n                            <div className=\"lg:col-span-2\">\r\n                                <div className=\"bg-white p-6 rounded-xl border border-slate-200 shadow-sm h-full\">\r\n                                    <div className=\"flex justify-between items-center mb-4\">\r\n                                        <h3 className=\"text-sm font-bold text-slate-800\">Evolu├º├úo: Org├ónico vs. Influenciado</h3>\r\n                                        <div className=\"flex gap-1 bg-slate-100 p-0.5 rounded-lg\">\r\n                                            {['mensal', 'trimestral'].map((m: any) => (\r\n                                                <button key={m} onClick={() => setImpactViewMode(m)} className={`px-3 py-1 text-[10px] font-bold rounded-md transition-all uppercase ${impactViewMode === m ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-400 hover:text-slate-600'}`}>{m}</button>\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"h-64\">\r\n                                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                            <AreaChart data={impactGraphData} margin={{ top: 10, right: 10, left: 0, bottom: 0 }}>\r\n                                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke={COLORS.grid} />\r\n                                                <XAxis dataKey=\"name\" axisLine={false} tickLine={false} tick={{ fontSize: 11, fill: '#64748b' }} dy={10} />\r\n                                                <YAxis axisLine={false} tickLine={false} tick={{ fontSize: 11, fill: '#64748b' }} tickFormatter={(val) => (val > 1000000 ? `R$ ${(val / 1000000).toFixed(1)}mi` : `R$ ${(val / 1000).toFixed(0)}k`)} />\r\n                                                <Tooltip content={<CustomTooltip type=\"currency\" />} cursor={{ stroke: '#cbd5e1' }} />\r\n                                                <Legend iconType=\"circle\" align=\"left\" verticalAlign=\"top\" height={36} wrapperStyle={{ fontSize: '12px' }} />\r\n                                                <Area type=\"monotone\" dataKey=\"revenueInfluenced\" name=\"Receita Influenciada\" stackId=\"1\" stroke={COLORS.success} fill={COLORS.success} fillOpacity={0.8} />\r\n                                                <Area type=\"monotone\" dataKey=\"revenueOrganic\" name=\"Receita Org├ónica\" stackId=\"1\" stroke={COLORS.primary} fill={COLORS.primary} fillOpacity={0.2} />\r\n                                            </AreaChart>\r\n                                        </ResponsiveContainer>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* BLOCO DE BAIXO: CANAIS (CARDS + TABELA) */}\r\n                        <div className=\"flex flex-col gap-6\">\r\n                            <div className=\"flex justify-between items-center\">\r\n                                <SectionTitle title=\"Performance por Canal\" subtitle={TEXTS.canais} />\r\n\r\n                                {/* FILTRO CANAIS */}\r\n                                <div className=\"relative\" ref={channelFilterRef}>\r\n                                    <button onClick={(e) => { e.stopPropagation(); setIsChannelFilterOpen(!isChannelFilterOpen); }} className=\"flex items-center gap-2 text-xs font-bold text-slate-600 bg-white border border-slate-200 px-3 py-1.5 rounded-lg hover:border-violet-400 transition\">\r\n                                        <Filter size={12} /> Filtrar Canais <ChevronDown size={12} />\r\n                                    </button>\r\n                                    {isChannelFilterOpen && (\r\n                                        <div className=\"absolute right-0 top-full mt-2 w-56 bg-white border border-slate-200 rounded-lg shadow-xl p-3 z-50\" onClick={(e) => e.stopPropagation()}>\r\n                                            <div className=\"space-y-1\">\r\n                                                {PRIMITIVE_CHANNELS.map(ch => (\r\n                                                    <div key={ch} className=\"flex items-center gap-2 p-1.5 hover:bg-slate-50 rounded cursor-pointer\" onClick={(e) => { e.preventDefault(); e.stopPropagation(); toggleChannelFilter(ch); }}>\r\n                                                        <div className={`w-4 h-4 rounded border flex items-center justify-center ${activeFilters.includes(ch) ? 'bg-violet-600 border-violet-600' : 'bg-white border-slate-300'}`}>\r\n                                                            {activeFilters.includes(ch) && <Check size={10} className=\"text-white\" />}\r\n                                                        </div>\r\n                                                        <span className=\"text-xs text-slate-700\">{ch}</span>\r\n                                                    </div>\r\n                                                ))}\r\n                                            </div>\r\n                                            <div className=\"pt-2 mt-2 border-t text-right\">\r\n                                                <span onClick={(e) => { e.stopPropagation(); setActiveFilters([]) }} className=\"text-[10px] font-bold text-red-500 cursor-pointer hover:underline\">Limpar</span>\r\n                                            </div>\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Bento Grid */}\r\n                            <div className={`grid gap-4 relative z-0 ${getGridClass(visibleCards.length)}`}>\r\n                                {visibleCards.map((card: any, idx: number) => (\r\n                                    <div key={idx} className={getSlotClass(idx, visibleCards.length)}>\r\n                                        <ModernChannelCard data={card} isBig={idx === 0 && visibleCards.length >= 3} />\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n\r\n                            {/* Tabela de Canais */}\r\n                            <ChannelsTable data={allTableData} />\r\n                        </div>\r\n                    </section>\r\n\r\n                    {/* 7. LISTA DE LOJAS */}\r\n                    <StoresTableSection stores={staticStores} />\r\n\r\n                </div>\r\n            </main>\r\n        </div>\r\n    );\r\n}\r\n\r\n// --- COMPONENTES VISUAIS (DESIGN SYSTEM) ---\r\n\r\nfunction SectionTitle({ title, subtitle }: { title: string, subtitle?: string }) {\r\n    return (\r\n        <div className=\"mb-4\">\r\n            <h2 className=\"text-lg font-bold text-slate-800 flex items-center gap-2\">\r\n                <span className=\"w-1 h-5 bg-violet-500 rounded-full\"></span>\r\n                {title}\r\n            </h2>\r\n            {subtitle && <p className=\"text-xs text-slate-400 ml-3 mt-0.5\">{subtitle}</p>}\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction ModernKPICard({ label, value, percent, active, onClick, icon, isRed, isCurrency, isPercent }: any) {\r\n    let display = value;\r\n    if (typeof value === 'number') {\r\n        if (isPercent) display = value.toFixed(2) + \"%\";\r\n        else if (isCurrency) display = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(value);\r\n        else display = value.toLocaleString('pt-BR');\r\n    }\r\n\r\n    return (\r\n        <div onClick={onClick} className={`relative bg-white p-5 rounded-xl border transition-all cursor-pointer group hover:-translate-y-1 ${active ? 'border-violet-500 shadow-md ring-1 ring-violet-500' : 'border-slate-200 hover:border-violet-300 shadow-sm'}`}>\r\n            <div className={`absolute top-0 left-0 w-full h-1 rounded-t-xl ${active ? 'bg-violet-500' : 'bg-transparent group-hover:bg-violet-200'}`} />\r\n            <div className=\"flex justify-between items-start mb-2\">\r\n                <span className=\"text-[11px] font-bold text-slate-500 uppercase tracking-wider\">{label}</span>\r\n                <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded flex items-center gap-0.5 ${isRed ? 'bg-red-50 text-red-600' : 'bg-emerald-50 text-emerald-600'}`}>\r\n                    {percent > 0 ? <ArrowUp size={10} /> : <ArrowDown size={10} />} {Math.abs(percent)}%\r\n                </span>\r\n            </div>\r\n            <div className=\"flex items-center gap-3\">\r\n                <div className={`p-2 rounded-lg ${active ? 'bg-violet-100 text-violet-700' : 'bg-slate-50 text-slate-400 group-hover:text-violet-500'}`}>{icon}</div>\r\n                <span className=\"text-2xl font-bold text-slate-800 tracking-tight\">{display}</span>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction TabButton({ label, active, onClick, tooltip }: any) {\r\n    return (\r\n        <div className=\"relative group\">\r\n            <button onClick={onClick} className={`flex items-center gap-2 px-4 py-1.5 text-xs font-bold rounded-full border transition-all ${active ? 'bg-slate-800 text-white border-slate-800' : 'bg-white text-slate-500 border-slate-200 hover:border-slate-300'}`}>\r\n                {label}\r\n                {tooltip && <Info size={10} className={active ? 'text-slate-400' : 'text-slate-300'} />}\r\n            </button>\r\n            {tooltip && (\r\n                <div className=\"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 bg-slate-800 text-white text-[10px] p-2 rounded-lg shadow-xl hidden group-hover:block z-50 text-center leading-relaxed opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none\">\r\n                    {tooltip}\r\n                    <div className=\"absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-800\"></div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction NavItem({ icon, label, active }: any) {\r\n    return (\r\n        <div className={`flex items-center gap-3 px-3 py-2.5 mx-2 rounded-lg cursor-pointer transition-all ${active ? 'bg-slate-800 text-white shadow-sm' : 'text-slate-400 hover:bg-slate-800/50 hover:text-white'}`}>\r\n            {icon}\r\n            <span className=\"text-sm font-medium hidden lg:block\">{label}</span>\r\n        </div>\r\n    )\r\n}\r\n\r\n\r\nfunction ModernChannelCard({ data, isBig }: any) {\r\n    if (!data) return null;\r\n    return (\r\n        <div className=\"relative overflow-hidden rounded-xl bg-white border border-slate-200 p-4 h-full flex flex-col justify-between hover:shadow-md transition-shadow group\">\r\n            <div className=\"flex justify-between items-start\">\r\n                <div className={`p-3 rounded-lg ${data.isOther ? 'bg-slate-100 text-slate-500' : 'bg-violet-50 text-violet-600'}`}>\r\n                    {CHANNEL_ICONS[data.name] || <Target size={20} />}\r\n                </div>\r\n                <span className=\"bg-slate-50 text-slate-600 text-[10px] font-bold px-2 py-1 rounded-full border border-slate-100\">\r\n                    {data.percent}%\r\n                </span>\r\n            </div>\r\n            <div>\r\n                <h4 className=\"text-slate-500 text-xs font-bold uppercase mb-1 mt-2\">{data.name}</h4>\r\n                <p className=\"text-lg font-bold text-slate-800\">\r\n                    {new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(data.value)}\r\n                </p>\r\n            </div>\r\n            {data.isOther && (\r\n                <div className=\"absolute inset-0 bg-white/95 backdrop-blur flex flex-col p-4 opacity-0 group-hover:opacity-100 transition-opacity justify-center\">\r\n                    <p className=\"text-[10px] font-bold text-slate-400 uppercase mb-2\">Detalhes</p>\r\n                    {data.items.slice(0, 3).map((it: any, idx: number) => (\r\n                        <div key={idx} className=\"flex justify-between text-xs py-1 border-b border-slate-100\">\r\n                            <span>{it.name}</span>\r\n                            <span className=\"font-bold\">{it.percent}%</span>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction StoresTableSection({ stores }: { stores: any[] }) {\r\n    const [search, setSearch] = useState(\"\");\r\n    const deferredSearch = useDeferredValue(search);\r\n    const [page, setPage] = useState(1);\r\n    const [perPage, setPerPage] = useState(5);\r\n    const [sortConfig, setSortConfig] = useState<{ key: string; direction: 'asc' | 'desc' }>({ key: 'revenue', direction: 'desc' });\r\n\r\n    const handleSort = (key: string) => {\r\n        setSortConfig((current) => ({ key, direction: current.key === key && current.direction === 'desc' ? 'asc' : 'desc' }));\r\n    };\r\n\r\n    const { paginatedStores, totalStores, totalPages } = useMemo(() => {\r\n        let processed = [...stores];\r\n        if (deferredSearch) processed = processed.filter(s => s.name.toLowerCase().includes(deferredSearch.toLowerCase()));\r\n\r\n        processed.sort((a, b) => {\r\n            let valA = a[sortConfig.key];\r\n            let valB = b[sortConfig.key];\r\n            if (typeof valA === 'string' && !isNaN(Number(valA))) valA = Number(valA);\r\n            if (typeof valB === 'string' && !isNaN(Number(valB))) valB = Number(valB);\r\n            return sortConfig.direction === 'asc' ? (valA < valB ? -1 : 1) : (valA > valB ? -1 : 1);\r\n        });\r\n\r\n        const start = (page - 1) * perPage;\r\n        return { paginatedStores: processed.slice(start, start + perPage), totalStores: processed.length, totalPages: Math.ceil(processed.length / perPage) };\r\n    }, [stores, deferredSearch, page, perPage, sortConfig]);\r\n\r\n    const SortHeader = ({ label, k, align = \"left\" }: any) => (\r\n        <th className={`px-6 py-3 text-xs font-bold text-slate-500 uppercase cursor-pointer hover:text-violet-600 transition text-${align}`} onClick={() => handleSort(k)}>\r\n            <div className={`flex items-center gap-1 ${align === \"right\" ? \"justify-end\" : align === \"center\" ? \"justify-center\" : \"justify-start\"}`}>\r\n                {label} {sortConfig.key === k && (sortConfig.direction === 'asc' ? <ArrowUp size={10} /> : <ArrowDown size={10} />)}\r\n            </div>\r\n        </th>\r\n    );\r\n\r\n    return (\r\n        <section>\r\n            <SectionTitle title=\"Ranking de Lojas\" />\r\n            <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden\">\r\n                <div className=\"p-4 border-b border-slate-100 flex items-center gap-2\">\r\n                    <Search className=\"text-slate-400\" size={16} />\r\n                    <input type=\"text\" placeholder=\"Filtrar lojas...\" value={search} onChange={(e) => setSearch(e.target.value)} className=\"text-sm outline-none w-full placeholder-slate-400 text-slate-700\" />\r\n                </div>\r\n                <table className=\"w-full text-sm text-left\">\r\n                    <thead className=\"bg-slate-50 border-b border-slate-100\">\r\n                        <tr>\r\n                            <SortHeader label=\"Loja\" k=\"name\" />\r\n                            <SortHeader label=\"Receita\" k=\"revenue\" />\r\n                            <SortHeader label=\"Influ├¬ncia\" k=\"revenueInfluenced\" />\r\n                            <SortHeader label=\"Transa├º├Áes\" k=\"transactions\" />\r\n                            <SortHeader label=\"Recompra\" k=\"repurchase\" align=\"center\" />\r\n                            <SortHeader label=\"PA\" k=\"itemsPerTicket\" align=\"center\" />\r\n                            <SortHeader label=\"Ticket M├®dio\" k=\"ticket\" align=\"right\" />\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody className=\"divide-y divide-slate-100\">\r\n                        {paginatedStores.map((s: any) => (\r\n                            <tr key={s.id} className=\"hover:bg-slate-50 transition-colors\">\r\n                                <td className=\"px-6 py-4 font-bold text-slate-700\">{s.name}</td>\r\n                                <td className=\"px-6 py-4 font-mono text-slate-600\">R$ {s.revenue.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>\r\n                                <td className=\"px-6 py-4 font-mono text-slate-600\">R$ {s.revenueInfluenced.toLocaleString('pt-BR', { maximumFractionDigits: 0 })}</td>\r\n                                <td className=\"px-6 py-4 text-slate-500\">{s.transactions}</td>\r\n                                <td className=\"px-6 py-4 text-center\"><span className=\"bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded text-xs font-bold\">{s.repurchase}%</span></td>\r\n                                <td className=\"px-6 py-4 text-center text-slate-600 font-mono\">{s.itemsPerTicket}</td>\r\n                                <td className=\"px-6 py-4 text-right font-bold text-slate-700\">R$ {s.ticket.toFixed(2)}</td>\r\n                            </tr>\r\n                        ))}\r\n                    </tbody>\r\n                </table>\r\n                <div className=\"p-4 border-t border-slate-100 flex justify-end gap-2 text-xs text-slate-500\">\r\n                    <button onClick={() => setPage(p => Math.max(1, p - 1))} disabled={page === 1} className=\"disabled:opacity-30 hover:text-violet-600 font-bold\"><ChevronLeft size={16} /></button>\r\n                    <span>P├ígina {page} de {totalPages}</span>\r\n                    <button onClick={() => setPage(p => Math.min(totalPages, p + 1))} disabled={page === totalPages} className=\"disabled:opacity-30 hover:text-violet-600 font-bold\"><ChevronRight size={16} /></button>\r\n                </div>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n\r\nfunction ChannelsTable({ data }: { data: any[] }) {\r\n    const [search, setSearch] = useState(\"\");\r\n    const deferred = useDeferredValue(search);\r\n    const filtered = useMemo(() => data.filter(c => c.name.toLowerCase().includes(deferred.toLowerCase())), [data, deferred]);\r\n\r\n    return (\r\n        <div className=\"bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden mt-6\">\r\n            <div className=\"p-4 border-b border-slate-100 flex justify-between\">\r\n                <div className=\"flex items-center gap-2 w-full max-w-xs bg-slate-50 px-3 py-1.5 rounded-lg border border-slate-200\">\r\n                    <Search size={14} className=\"text-slate-400\" />\r\n                    <input type=\"text\" placeholder=\"Buscar canal...\" className=\"bg-transparent outline-none text-xs w-full\" value={search} onChange={e => setSearch(e.target.value)} />\r\n                </div>\r\n                <button className=\"text-xs font-bold text-violet-600 hover:bg-violet-50 px-3 py-1.5 rounded-lg transition\">Exportar CSV</button>\r\n            </div>\r\n            <table className=\"w-full text-sm\">\r\n                <thead className=\"bg-slate-50 text-xs font-bold text-slate-500 uppercase text-left\">\r\n                    <tr><th className=\"px-6 py-3\">Canal</th><th className=\"px-6 py-3\">Receita</th><th className=\"px-6 py-3 text-right\">% Share</th></tr>\r\n                </thead>\r\n                <tbody className=\"divide-y divide-slate-100\">\r\n                    {filtered.map((ch: any, i: number) => (\r\n                        <tr key={i} className=\"hover:bg-slate-50\">\r\n                            <td className=\"px-6 py-3 font-bold text-slate-700 flex items-center gap-2\">{CHANNEL_ICONS[ch.name] || <Target size={16} />} {ch.name}</td>\r\n                            <td className=\"px-6 py-3 font-mono text-slate-600\">R$ {ch.value.toLocaleString('pt-BR')}</td>\r\n                            <td className=\"px-6 py-3 text-right\"><span className=\"bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-xs font-bold\">{ch.percent}%</span></td>\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>\r\n        </div>\r\n    )\r\n}\r\n\r\nfunction getGridClass(count: number) {\r\n    if (count <= 2) return \"grid-cols-1 lg:grid-cols-2 h-[200px]\"; // Altura menor, mais compacto\r\n    if (count === 3) return \"grid-cols-1 lg:grid-cols-3 h-[200px]\";\r\n    return \"grid-cols-1 lg:grid-cols-3 h-[400px]\";\r\n}\r\n\r\nfunction getSlotClass(index: number, total: number) {\r\n    if (total > 4 && index === 0) return \"lg:col-span-2 lg:row-span-2 h-full\";\r\n    return \"col-span-1 h-full\";\r\n}\r\n\r\nconst CustomTooltip = ({ active, payload, label, type }: any) => {\r\n    if (active && payload && payload.length) {\r\n        return (\r\n            <div className=\"bg-slate-900 text-white p-3 shadow-xl rounded-lg text-xs border border-slate-700\">\r\n                <p className=\"font-bold text-slate-400 mb-2 uppercase tracking-wider\">{label}</p>\r\n                {payload.map((entry: any, index: number) => (\r\n                    <div key={index} className=\"flex items-center gap-2 mb-1\">\r\n                        <div className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: entry.color }}></div>\r\n                        <span className=\"text-slate-300\">{entry.name}:</span>\r\n                        <span className=\"font-bold text-white ml-auto\">\r\n                            {type === 'currency' ? `R$ ${entry.value.toLocaleString('pt-BR')}` : entry.value.toLocaleString('pt-BR')}\r\n                        </span>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        );\r\n    }\r\n    return null;\r\n};","usedDeprecatedRules":[]}]
